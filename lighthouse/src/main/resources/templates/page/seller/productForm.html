<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/insertModifyPro}">
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<!-- Content -->
<style>
   .card-img-top {
      position: relative;
      width: 540px;
      height: 480px;
      margin: 0 auto;
   }

   .photo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      transition: transform .5s ease-out;
   }
   .modal {
      --bs-modal-width: 900px;
   }
   
  
   
  
</style>


<div layout:fragment="sellerContent">

  
      <div class="col-12 col-lg" style="background-color: #E7E9EB; padding-top: 80px; padding-bottom:100px;">
         <div class="row">
            <div class="col-12 col-md-9 col-lg-8 offset-lg-1">
              <!-- Form -->
            <form id="insertForm" class="form-horizontal" action="/insertProduct" method="post" enctype="multipart/form-data">
               <div class="row">
                 <div class="col-12">
                     <!-- 상품명 -->
                     <div class="form-group">
                           <h2>상품 등록</h2>
                     </div>
                  </div>
               <div class="col-12">
                  <!-- 카테고리 들어갈곳 -->
                     <div class="form-group">
                        <label class="form-label">카테고리 선택 *</label>
                        <div class="row gx-5">
                           <div class="categorybox col-md-3">
                              <label class="visually-hidden" for="categoryCode">
                                 1단계 카테고리
                              </label>
                              <select class="form-select form-select-sm" id="categoryCode">
                                 <option value="1" class="disabledsel" disabled selected>카테고리선택</option>
                                 <option th:each="category : ${getCategoryList}" th:value="${category.categoryCode}"
                                    th:text="${category.categoryName}" th:if="${category.categoryLevel == 1}"></option>
                              </select>
                           </div>
                           <div class="categorybox1 col-md-3" style="display: none;">
                              <label class="visually-hidden" for="categoryCode01">
                                 2단계 카테고리
                              </label>
                              <select class="disabledsel form-select form-select-sm" id="categoryCode01">
                                 
                              </select>
                           </div>
                           <div class="categorybox2 col-md-3" style="display: none;">
                              <label class="visually-hidden" for="categoryCode02">
                                 3단계 카테고리
                              </label>
                              <select class="disabledsel form-select form-select-sm" id="categoryCode02">
                                 
                              </select>
                           </div>
                           <div class="categorybox3 col-md-3" style="display: none;">
                              <label class="visually-hidden" for="categoryCode03">
                                 4단계 카테고리
                              </label>
                              <select class="disabledsel form-select form-select-sm" id="categoryCode03">
                                 
                              </select>
                           </div>
                        </div>
                     </div>
                  </div>
                  <!-- 여기! -->
                  <div class="col-12">
                     <!-- 상품명 -->
                     <div class="form-group">
                        <label class="form-label" for="productName">
                           상품명 *
                        </label>
                        <input class="form-control form-control-sm" id="productName" type="text" placeholder="상품명을 입력해주세요" name="productName" maxlength="70">
                     </div>
                  </div>
                  <div class="col-12 col-md-4">
                    <!-- 판매가 -->
                    <div class="form-group">
                      <label class="form-label" for="productCost">
                         판매가 *
                      </label>
                      <input class="form-control form-control-sm" type="number" id="productCost" name="productCost" placeholder="판매가를 입력하세요" min="1">
                    </div>
  
                  </div>
                  <div class="col-12 col-md-4">
                    <!-- 할인가 -->
                    <div class="form-group">
                      <label class="form-label" for="accountLastName">
                        할인가 *
                      </label>
                      <input type="number" id="salePrice" name="salePrice" class="form-control form-control-sm" max="99999999" placeholder="할인가를 입력해주세요" min="1">
                    </div>
  
                  </div>
                  <div class="col-12 col-md-4">
                    <!-- 수량 -->
                    <div class="countdiv form-group">
                      <label class="form-label" for="productCount">
                        수량 *
                      </label>
                      <input type="number" id="productCount" name="productCount" class="form-control form-control-sm" max="99999999" placeholder="재고수량을 입력해주세요" min="1">
                    </div>
  
                  </div>
                  <div class="col-12 col-md-3">
                     <label class="form-label" for="accountPassword">
                        옵션 *
                     </label>
                     <div class="form-group input-group input-group-merge" id="optionPlz">
                        <select class="optionsel form-select form-select-sm" id="optCnt" name="optCnt">
                        <th:block th:each="option, iterStat : ${product}">
				            <option th:text="${option.optionName1}"></option>
				            <th:block th:each="value : ${option.optionValue1.split(',')}">
				                <option th:text="${value}"></option>
				            </th:block>
				        </th:block>
                           <option value="0" selected>----</option>
                           <option value="1">1</option>
                           <option value="2">2</option>
                           <option value="3">3</option>
                        </select>
                        <div class="input-group-append">
                          <input type="hidden" value="N" id="optionNum" name="optionNum" readonly>
                          <button class="btn btn btn-outline-info" type="button" id="addOption">
                            옵션등록
                          </button>
                        </div>
                     </div>
                  </div>
                  <!-- 옵션 input 들어갈곳 -->
                  <div class="optionB col-12 col-lg" style="margin-bottom: 15px;">
                     
                  </div>
                  <!-- ///////// -->
                  <div class="col-12">
                     <div class="tableWrapper form-group">
                        <table class="table table-bordered table-sm mb-0" style="background-color: white;" id="userListTable">
                           <thead>
                             <tr>
                               <th scope="col">옵션명</th>
                               <th scope="col">옵션가격</th>
                               <th scope="col">옵션수량</th>
                               <th scope="col">최소구매수량</th>
                               <th scope="col">최대구매수량</th>
                             </tr>
                           </thead>
                           <tbody id="optiontab">
                             
                           </tbody>
                         </table>
                     </div>
                   </div>
                   <div class="col-12 col-lg-12">
                     <div class="form-group mb-8">
                        <div class="input-group mb-3">
                           <label class="input-group-text" for="imgName">메인이미지</label>
                           <input type="file" class="form-control" id="imgName" name="files" accept="image/*" onchange="setThumbnail(event);">
                         </div>
                           <div id="image_container" 
                              >


                           </div>
                     </div>
                   </div>
                  
                   <div class="col-12 col-lg-6">
                     <div class="form-group mb-8">
                       <label class="form-label">상세설명</label>
                       <div>
                         <input class="btn-check" type="button" name="detailBox" id="male" checked="">
                         <label class="detailPro btn btn-sm btn-outline-border" for="detailBox">작성하러가기</label>
                       </div>
                     </div>
                   </div>
                   <div class="col-12">
                     <!-- 상품명 -->
                     <div class="form-group">
                        <label class="form-label" for="productBrand">
                           브랜드 *
                        </label>
                        <input class="form-control form-control-sm" id="productBrand" type="text" placeholder="브랜드을 입력해주세요" name="productBrand" maxlength="30">
                     </div>
                  </div>
                  <div class="col-12">
                     <!-- 상품명 -->
                     <div class="form-group">
                        <label class="form-label" for="productOrigin">
                           원산지 *
                        </label>
                        <input class="form-control form-control-sm" id="productOrigin" type="text" placeholder="원산지을 입력해주세요" name="productOrigin" maxlength="15">
                     </div>
                  </div>
                  <div class="col-12">
                     <!-- 상품명 -->
                     <div class="form-group">
                        <label class="form-label" for="productMakeorigin">
                           제조국 *
                        </label>
                        <input class="form-control form-control-sm" id="productMakeorigin" type="text" placeholder="제조국을 입력해주세요" name="productMakeorigin" maxlength="15">
                     </div>
                  </div>
                  <div class="col-12">
                     <!-- 상품명 -->
                     <div class="form-group">
                        <label class="form-label" for="productLocation">
                           출고지 *
                        </label>
                        <input class="form-control form-control-sm" id="productLocation" type="text" placeholder="출고지을 입력해주세요" name="productLocation" maxlength="70">
                     </div>
                  </div>
                  <div class="col-12 col-md-4">
                     <!-- 판매가 -->
                     <div class="form-group">
                       <label class="form-label" for="deliveryCost">
                        기본배송비 *
                       </label>
                       <input class="form-control form-control-sm" type="number" id="deliveryCost" name="deliveryCost" max="99999999" placeholder="0" min="1">
                     </div>
   
                   </div>
                   <div class="col-12 col-md-4">
                     <!-- 할인가 -->
                     <div class="form-group">
                       <label class="form-label" for="exchangeCost">
                        교환배송비 *
                       </label>
                       <input type="number" id="exchangeCost" name="exchangeCost" class="form-control form-control-sm" max="99999999" placeholder="0" min="1">
                     </div>
   
                   </div>
                   <div class="col-12 col-md-4">
                     <!-- 수량 -->
                     <div class="form-group">
                       <label class="form-label" for="returnCost">
                         반품배송비 *
                       </label>
                       <input type="number" id="returnCost" name="returnCost" class="form-control form-control-sm" max="99999999" placeholder="0" min="1">
                     </div>
   
                   </div>
                   <div class="categorybox col-md-4">
                     <label class="form-label" for="deliveryService">
                        택배사 *
                      </label>
                     <select class="form-select form-select-sm" id="deliveryService" name="deliveryService">
                        <option value="" disabled="disabled" selected>택배사 선택</option>
                        <option th:each="del : ${delivery}" th:value="${del.codeId}" th:text="${del.codeName}"></option>
                     </select>
                  </div>
               
                  <div class="col-12" style="margin-top:50px">
                    <!-- Button -->
                    <button type="button" class="submit btn btn-dark">등록</button>
                     <button type="button" class="storage btn btn-secondary">임시 저장</button>
                     <button type="button" class="modalBtn btn btn-info" data-bs-toggle="modal"
                        data-bs-target="#exampleModal">
                        미리보기
                     </button>
  
                  </div>
                </div>
              </form>
  
            </div>
          </div>

      </div>
      <!-- Modal -->
      <div class="modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
         <div class="modal-dialog modal-lg">
            <div class="modal-content">
               <div class="modal-header">
                  <h1 class="modal-title fs-8" id="exampleModalLabel">미리보기</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                  <section>
                     <div class="container">
                        <div class="row">
                           <div class="col-12">
                              <div class="row">
                                 <div class="col-12 col-md-6">
                                    <!-- Slider -->
                                    <div class="flickity-nav mx-n2 mb-10 mb-md-0" style="height: 100%;">
                                       <div class="Mimg ratio-1x1 bg-cover" style="height: 100%;">
                                          <!-- 이미지 들어갈곳 -->
                                       </div>
                                    </div>
                                 </div>

                                 <div class="col-12 col-md-6 ps-lg-10">
                                    <!-- Header -->
                                    <div class="row mb-1">
                                       <div class="col">
                                          <!-- Preheading -->
                                          <a class="Mcate text-muted">카테고리 들어가는곳</a>
                                       </div>
                                       <div class="col-auto">
                                          <!-- Rating -->
                                          <div class="rating fs-xs text-dark">
                                             <div class="rating-item">
                                                <i class="fas fa-star"></i>
                                             </div>
                                             <div class="rating-item">
                                                <i class="fas fa-star"></i>
                                             </div>
                                             <div class="rating-item">
                                                <i class="fas fa-star"></i>
                                             </div>
                                             <div class="rating-item">
                                                <i class="fas fa-star"></i>
                                             </div>
                                             <div class="rating-item">
                                                <i class="fas fa-star"></i>
                                             </div>
                                          </div>
                                       </div>
                                    </div>

                                    <!-- Heading -->
                                    <h3 class="MproName mb-2"></h3>

                                    <!-- Price -->
                                    <div class="mb-7">
                                       <span
                                          class="Mprice fs-lg fw-bold text-gray-350 text-decoration-line-through"></span>
                                       <span class="MSale ms-1 fs-5 fw-bolder text-primary"></span>
                                    </div>

                                    <!-- Form -->
                                    <div class="form-group"
                                       style="font-size: 15px; border-bottom: 1px solid rgba(0, 0, 0, 0.3)">
                                       <div style="padding-bottom: 8px; color: grey">
                                          <span>배송정보 : </span> <span class="Mdelivery"></span>
                                       </div>
                                       <div style="padding-bottom: 8px; color: grey">
                                          <span>배송비 : </span> <span class="Mdelprice"></span>
                                       </div>
                                       <div style="padding-bottom: 8px; color: grey">
                                          <span>원산지 : </span> <span class="Mmaker"></span>
                                       </div>
                                    </div>


                                    <div class="form-group">
                                       <!-- Label -->

                                       <div class="mb-2" style="padding-bottom: 24px">
                                          <!-- option -->
                                          <div class="col-12 col-lg-auto">
                                             <div class="selectbox">
                                                <!-- <select class="selectbox form-select mb-2">
                                                   <option class="selectbox1" value=""> 옵션들어가는곳
                                                   </option>

                                                </select>
                                                <select class="selectbox1 form-select mb-2">
                                                   <option class="selectbox1" value=""> 옵션들어가는곳
                                                   </option>

                                                </select> -->
                                             </div>
                                          </div>
                                          <div class="col-12 col-lg-auto">
                                             <div
                                                style="display: flex; justify-content: space-between; padding: 20px 0px 40px 0px; color: black"
                                                class="num">

                                                <div>
                                                   <span style="font-size: 22px; color: grey" id="realPrice">합계:0</span>
                                                </div>
                                             </div>
                                          </div>
                                          <div class="row gx-5 mb-7">
                                             <div class="col-12 col-lg">
                                                <!-- Submit -->
                                                <button type="button" class="btn w-100 btn-dark mb-2">장바구니 <i
                                                      class="fe fe-shopping-cart ms-2"></i>
                                                </button>
                                             </div>
                                             <div class="col-12 col-lg-auto">
                                                <!-- Wishlist -->
                                                <button class="btn btn-outline-dark w-100 mb-2">
                                                   찜 <i class="fe fe-heart ms-2"></i>
                                                </button>

                                             </div>
                                          </div>

                                          <p>
                                             <span class="text-gray-500">아이디가 없나요?</span> <a
                                                class="text-reset text-decoration-underline" id="loginTag">지금
                                                바로 회원가입!</a>
                                          </p>
                                       </div>
                                    </div>
                                    <!-- Text -->

                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </section>

                  <!-- DESCRIPTION -->
                  <section class="pt-11">
                     <div class="container">
                        <div class="row">
                           <div class="col-12">
                              <!-- Nav -->
                              <div
                                 class="nav nav-tabs nav-overflow justify-content-start justify-content-md-center border-bottom"
                                 style="font-size: 24px; position: sticky; top: 0px; background-color: white; z-index: 1">
                                 <a class="menu nav-link">
                                    상세정보
                                 </a>
                                 <a class="menu nav-link">리뷰
                                    <strong class="fs-sm ms" name="reviewCount">(0)</strong>
                                 </a> <a class="menu nav-link">
                                    Q&A <strong class="fs-sm" name="inquiryCont">(0)</strong>
                                 </a>
                              </div>
                              <!-- Content -->
                              <div class="tab-content">
                                 <div class="">
                                    <div style="padding-top: 48px">
                                       <h5 class="mb-5 text-center">표기 정보</h5>
                                       <table class="table">
                                          <thead>
                                             <tr>
                                                <th scope="col" style="font-weight: 600">제품명</th>
                                                <th scope="col" class="MproName"></th>
                                                <th scope="row" style="font-weight: 600">판매자</th>
                                                <th scope="row" id="sellerId" class="sellerName"></th>
                                             </tr>
                                          </thead>

                                          <tbody>
                                             <tr>
                                                <th scope="row" style="font-weight: 600">사업자번호</th>
                                                <th scope="row" class="sellerNum"></th>
                                                <th scope="row" style="font-weight: 600">원가</th>
                                                <th scope="row" class="Mprice">원가 </th>
                                             </tr>
                                             <tr>
                                                <td scope="row" style="font-weight: 600">등록날짜</td>
                                                <td scope="row" class="today"></td>
                                             </tr>
                                             <tr>
                                                <td scope="row" style="font-weight: 600">배송방법</td>
                                                <td scope="row" class="Mdelivery">배송방법</td>
                                                <td scope="row" style="font-weight: 600">배송비</td>
                                                <td scope="row" class="Mdelprice">배송비</td>
                                             </tr>

                                             <tr>
                                                <td scope="row" style="font-weight: 600">원산지</td>
                                                <td scope="row" class="Mmaker">원산지</td>
                                             </tr>
                                          </tbody>
                                       </table>
                                    </div>

                                    <!-- 상세내용 -->
                                    <div style="padding: 48px 0px">
                                       <div class="Mdetail"></div>
                                    </div>
                                 </div>
                              </div>

                           </div>
                        </div>
                     </div>
                  </section>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
               </div>
            </div>
         </div>

      <script th:inline="javascript">
         let test22 = "";
         let optbox = "";
         let optbox1 = "";
         let numberBox = $('input[type="number"]');

         $(window).on("load", function () {
            optbox = $('.optionN');
            optbox1 = $('.optionV');

         })

         

         $(document).ready(function () {
               // 페이지 이동 이벤트를 감지하기 위해 이벤트 핸들러를 추가합니다.
               localStorage.removeItem('detail');
               localStorage.removeItem('product');
               $(window).on("beforeunload", function() {
                  // 사용자에게 메시지를 반환합니다. 이 메시지가 브라우저에 표시됩니다.
                  var currentURL = test22;

                  if (currentURL !== "/insertProduct") {
                     // 특정 주소가 아닐 때만 사용자에게 메시지를 반환합니다.
                     return "페이지를 떠나시겠습니까? 변경사항이 저장되지 않을 수 있습니다.";
                  }
               });

 
               // X
               let userData = JSON.parse(localStorage.getItem("product"));
               let detailData = JSON.parse(localStorage.getItem("detail"));

               if (userData != null) {
                  if (Date.now() > userData.expire) {
                     localStorage.removeItem("product");
                     localStorage.removeItem("detail");
                     return;
                  }
                  let inputTag = $("#insertForm").find("input").not("[type='button']").not("[type='file']");

                  $.each(userData, function (key, value) {

                     for (let data of inputTag) {
                        let dataName = $(data).attr('name');
                        if (dataName == key) {
                           $(data).val(value);

                        }

                     }


                  })
                  if (userData.deliveryService != '') {
                     $('#deliveryService').val(userData.deliveryService);
                  }



                  if (userData.optCnt != 0) {
                     $('.optionText').show();
                     $('.countdiv').css("display", "none");
                     $('#productCount').val('');
                     $('#optCnt').val(userData.optCnt);
                     for (let i = 0; i < userData.optCnt; i++) {
                      
                        let divBox = $('<div/>');
                        let div = $('<div/>').addClass("optionDiv col input-group mb-3");
                        let span = $('<span/>');
                        span.text("옵션명"+ (i+1));
                        span.addClass("input-group-text");

                        div.append(span);
                        let optionN = $('<input name="option[' + i +
                           '].optionName" class="optionN form-control" type="text" id="optionName' + i + '" value="'+userData.option[i].optionName1+'"/>');

                        // let div = $('<div/>').addClass("optionDiv col-md-6");
                        // let labelN = $("<label> /").text("옵션이름");
                        // let optionN = $('<input name="option[' + i +
                        //    '].optionName" class="optionN form-control" type="text" id="optionName' + i + '"/>');
                        div.append(optionN);
                        $('.optionB').append(div);

                        div = $('<div/>').addClass("optionDiv col input-group mb-3");
                        span = $('<span/>');
                        span.text("옵션값"+ (i+1));
                        span.addClass("input-group-text");
                        div.append(span);
                        let optionV = $('<input name="option[' + i +
                           '].optionValue" class="optionV form-control" type="text" placeholder="ex) 파랑,노랑,초록" id="optionVal' + i +
                           '" value="'+userData.option[i].optionValue1+'"/>');

                        div.append(optionV);
                        divBox.append(div);
                        $('.optionB').append(divBox);
                     }
                  }

                  /* if (userData.imgInfo != "") {

                     let div = $("div#image_container");
                     let img = $("<img/>");
                     $(img).attr('src', userData.imgInfo);
                     $(img).css("width", "300px");
                     $(img).css("height", "300px");
                     let divTag = $("<div />");
                     divTag.css("display","flex")

                     divTag.append(img);
                     let inputTag = $('<input/>');
                     $(inputTag).val(userData.imgInfo);
                     $(inputTag).attr('id', "Imginform");
                     $(inputTag).attr("type", "hidden");

                     let textarea = $('<textarea/>');
                     $(textarea).val(userData.productImgCon);
                     $(textarea).attr("id", "productImgCon")
                     $(textarea).attr("name", "productImg[0].imgContent");
                     $(textarea).addClass("form-control");

                     divTag.append(textarea);
                     divTag.append(inputTag);

                     div.append(divTag);
                  } */

                  if (Object.keys(userData.catemenu[0]).length != 0) {
                     let obj = userData.catemenu[0];
                     let keyword = '';
                     let seloption
                     let select = $('#categoryCode');
                     for (var key in obj) {
                        if (key.charAt(0) == 0) {
                           keyword = key.substr(1);
                           keyval = obj[key];
                        }
                     }

                     $('#categoryCode01').attr("name", "categoryCode");
                     $(select).val(keyval);

                  }

                  if (Object.keys(userData.catemenu[1]).length != 0) {
                     $('.categorybox1').css('display', 'block');
                     let obj = userData.catemenu[1];
                     let keyword = '';
                     let select = $('#categoryCode01');
                     for (var key in obj) {
                        if (key.charAt(0) == 0) {
                           keyword = key.substr(1);
                           keyval = obj[key];
                           let opt = $('<option>' + keyword + '</option>');
                           opt.attr('value', keyval);
                           opt.attr('class', 'optionBox');
                           opt.prop("selected", true);
                           select.append(opt);
                        } else {
                           let opt = $('<option>' + key + '</option>');
                           opt.attr('value', obj[key]);
                           opt.attr('class', 'optionBox');
                           select.append(opt);
                        }
                     }

                     if (Object.keys(userData.catemenu[2]).length != 0) {
                        $('#categoryCode').removeAttr("name");
                        $('#categoryCode01').removeAttr("name");
                        $('#categoryCode02').attr("name", "categoryCode");
                        $('#categoryCode03').removeAttr("name");
                     }
                  }

                  if (Object.keys(userData.catemenu[2]).length != 0) {
                     $('.categorybox2').css('display', 'block');

                     let obj = userData.catemenu[2];
                     let keyword = '';
                     let select = $('#categoryCode02');
                     for (var key in obj) {
                        if (key.charAt(0) == 0) {
                           keyword = key.substr(1);
                           keyval = obj[key];
                           let opt = $('<option>' + keyword + '</option>');
                           opt.attr('value', keyval);
                           opt.attr('class', 'optionBox');
                           opt.prop("selected", true);
                           select.append(opt);
                        } else {
                           let opt = $('<option>' + key + '</option>');
                           opt.attr('value', obj[key]);
                           opt.attr('class', 'optionBox');
                           select.append(opt);
                        }
                     }
                     if (Object.keys(userData.catemenu[3]).length != 0) {

                        $('#categoryCode').removeAttr("name");
                        $('#categoryCode01').removeAttr("name");
                        $('#categoryCode02').removeAttr("name");
                        $('#categoryCode03').attr("name", "categoryCode");
                     }
                  }

                  if (Object.keys(userData.catemenu[3]).length != 0) {
                     $('.categorybox3').css('display', 'block');

                     let obj = userData.catemenu[3];
                     let keyword = '';
                     let select = $('#categoryCode03');
                     for (var key in obj) {
                        if (key.charAt(0) == 0) {
                           keyword = key.substr(1);
                           keyval = obj[key];
                           let opt = $('<option>' + keyword + '</option>');
                           opt.attr('value', keyval);
                           opt.attr('class', 'optionBox');
                           opt.prop("selected", true);
                           select.append(opt);
                        } else {
                           let opt = $('<option>' + key + '</option>');
                           opt.attr('value', obj[key]);
                           opt.attr('class', 'optionBox');
                           select.append(opt);
                        }
                     }
                  }

                  if (userData.optionDetail.length > 0) {
                     for (let i = 0; i < userData.optionDetail.length; i++) {
                        let trtag = $("<tr/>");
                        let obj = userData.optionDetail[i];
                        for (var key in obj) {
                           let tdTag = $("<td/>");
                           let inputTag = $('<input/>');
                           if (key == "optionLast") {
                              inputTag.attr("name", "optionDetail[" + i + "]." + key);
                              inputTag.attr("id", key + i);
                              inputTag.addClass("form-control");
                              inputTag.attr("type", "text");
                              inputTag.prop("readonly", true);
                              $(inputTag).val(obj[key]);
                           } else {
                              inputTag.attr("name", "optionDetail[" + i + "]." + key);
                              inputTag.addClass("form-control");
                              inputTag.attr("id", key + i);
                              inputTag.attr("type", "number");
                              inputTag.attr("placeholder", 0);
                              inputTag.css("width", "100px");
                              $(inputTag).val(obj[key]);
                           }
                           tdTag.append(inputTag);
                           trtag.append(tdTag);
                        }
                        $('#optiontab').append(trtag);
                     }
                  }

               }
               if (detailData != null) {
                  let formT = $('#insertForm');
                  if (detailData.content != null || detailData.content != '') {
                     let textarea = $('<textarea>' + detailData.content + '</textarea>');
                     textarea.css("display", "none");
                     textarea.attr("name", "productContent");
                     $(formT).prepend(textarea);
                  }

                  if (detailData.img.length != 0) {
                     for (let i = 0; i < detailData.img.length; i++) {
                        let divTab = $('<div/>');
                        let obj = detailData.img[i];
                        for (var key in obj) {
                           let input = $('<input/>');
                           $(input).val(obj[key]);
                           input.attr("type", "hidden");
                           input.attr("name", "imgsVO[" + i + "]." + key);
                           input.addClass(key);
                           divTab.append(input);
                        }
                        $(divTab).appendTo(formT);
                     }
                  }
               }


            })
            // 옵션 input 창   
            -
            $('.optionsel').on('change', function (e) {
               let val = $(this).val();
               $('.optionB').children().remove();
               $('#optiontab').children().remove();
               if (val != 0) {
                  $('.optionText').show();
                  $('#optionCount').val('');
                  $('#productCount').val('');
                  $('.countdiv').hide();
               } else {
                  $('.optionText').hide();
                  $('.countdiv').show();
               }


               for (let i = 0; i < val; i++) {
                  let divBox = $('<div/>');
                  let div = $('<div/>').addClass("optionDiv col input-group mb-3");
                  let span = $('<span/>');
                  span.text("옵션명"+ (i+1));
                  span.addClass("input-group-text");

                  div.append(span);
                  let optionN = $('<input name="option[' + i +
                     '].optionName" class="optionN form-control" type="text" id="optionName' + i + '"/>');

                  // let div = $('<div/>').addClass("optionDiv col-md-6");
                  // let labelN = $("<label> /").text("옵션이름");
                  // let optionN = $('<input name="option[' + i +
                  //    '].optionName" class="optionN form-control" type="text" id="optionName' + i + '"/>');
                  div.append(optionN);
                  $('.optionB').append(div);

                  div = $('<div/>').addClass("optionDiv col input-group mb-3");
                  span = $('<span/>');
                  span.text("옵션값"+ (i+1));
                  span.addClass("input-group-text");
                  div.append(span);
                  let optionV = $('<input name="option[' + i +
                     '].optionValue" class="optionV form-control" type="text" placeholder="ex) 파랑,노랑,초록" id="optionVal' + i +
                     '" />');

                  div.append(optionV);
                  divBox.append(div);
                  $('.optionB').append(divBox);

               }
            })





         $(document).on('change', '#categoryCode', function (e) {
            let val = $(this).val();
            let cateBox = [[${getCategoryList}]];
            let option = $('#categoryCode01');
            $('.optionBox').remove();
            $('.optionBox01').remove();
            $('.optionBox02').remove();
            $('.categorybox1').css('display', 'block');
            $('.categorybox2').css('display', 'none');
            $('.categorybox3').css('display', 'none');
            $('#categoryCode01').val(1);
            $('#categoryCode02').val(1);
            $('#categoryCode03').val(1);
            $('#categoryCode01').removeAttr('name');
            $('#categoryCode02').removeAttr('name');
            $('#categoryCode03').removeAttr('name');
            $('#categoryCode01').attr("name", "categoryCode");

            let firoption = $('<option>' + "카테고리선택" + '</option>');
            firoption.attr('value', 1);
            firoption.addClass("optionBox");
            firoption.prop("selected", true);
            firoption.prop("disabled", true);
            option.append(firoption);
            $(cateBox).each(function (idx, item) {
               if (item.parentCategoryCode == val) {
                  let opt = $('<option>' + item.categoryName + '</option>');
                  opt.attr('value', item.categoryCode);
                  opt.attr('class', 'optionBox');
                  option.append(opt);
               }
            })
         })

         $(document).on('change', '#categoryCode01', function () {

            let val = $(this).val();
            $('#categoryCode02').val(1);
            let cateBox = [[${getCategoryList}]];
            let option = $('#categoryCode02');
            $('.optionBox01').remove();
            $('.optionBox02').remove();

            let num = 0;
            $(cateBox).each(function (idx, item) {
               if (item.parentCategoryCode == val) {
                  let opt = $('<option>' + item.categoryName + '</option>');
                  opt.attr('class', 'optionBox01');
                  opt.attr('value', item.categoryCode);
                  option.append(opt);
                  num++
               }
            })
            if (num != 0) {
               $('.categorybox2').css('display', 'block');
               $('.categorybox3').css('display', 'none');
               $('#categoryCode01').removeAttr('name');
               $('#categoryCode02').attr('name', 'categoryCode');
               let firoption = $('<option>' + "카테고리선택" + '</option>');
               firoption.attr('value', 1);
               firoption.prop("selected", true);
               firoption.prop("disabled", true);
               firoption.addClass("optionBox01");
               option.prepend(firoption);
            } else {
               $('#categoryCode01').attr('name', 'categoryCode');
               $('#categoryCode02').removeAttr('name');
               $('#categoryCode03').children().remove();

               $('.categorybox2').css('display', 'none');

            }
         })

         $(document).on('change', '#categoryCode02', function () {
            let val = $(this).val();
            let cateBox = [[${getCategoryList}]];
            let option = $('#categoryCode03');
            $('.optionBox02').remove();
            $('#categoryCode03').val(1);
            let num = 0;

            $(cateBox).each(function (idx, item) {
               if (item.parentCategoryCode == val) {
                  let opt = $('<option>' + item.categoryName + '</option>');
                  opt.attr('class', 'optionBox02');
                  opt.attr('value', item.categoryCode);

                  option.append(opt);
                  num++
               }
            })
            if (num != 0) {
               let firoption = $('<option>' + "카테고리선택" + '</option>');
               firoption.attr('value', 1);
               firoption.prop("selected", true);
               firoption.prop("disabled", true);
               firoption.addClass("optionBox02");
               option.prepend(firoption);
               $('.categorybox3').css('display', 'block');
               $('#categoryCode02').removeAttr('name');
               $('#categoryCode03').attr('name', 'categoryCode');
            } else {
               $('.categorybox3').css('display', 'none');
            }
         })

         // 이미지 미리보기
         function setThumbnail(event) {
            var reader = new FileReader();

               reader.onload = function (event) {
               var div = document.querySelector("div#image_container");
               div.innerHTML = "";
               var divTag = document.createElement("div");
               divTag.style.display = "flex";
               var img = document.createElement("img");
               img.setAttribute("src", event.target.result);
               img.style.width = "300px";
               img.style.height = "300px";
               divTag.append(img);
               var srcinput = document.createElement('input');
               srcinput.value = event.target.result;
               srcinput.id = 'Imginform';
               srcinput.setAttribute("type", "hidden");
               var input = document.createElement('input');
               var textarea = document.createElement("textarea");
               textarea.setAttribute("name", "productImg[0].imgContent");
               textarea.setAttribute("class","form-control");
               textarea.setAttribute("id", "productImgCon");

               divTag.append(textarea);
               divTag.append(srcinput);
               document.querySelector("div#image_container").append(divTag)

            };

            reader.readAsDataURL(event.target.files[0]);
         }

         $('#addOption').on('click', function (e) {
            if ($('#optCnt').val() == 0) {
               alert("등록하실 옵션이 없습니다.")
            } else {
               optbox = $('.optionN');
               optbox1 = $('.optionV');

               $('#optiontab').empty();
               let optionD = $('.optionDiv');
               let optionN = $('.optionN');
               let optionV = $('.optionV');
               let tbody = $('#optiontab');
               for (let x = 0; x < optionN.length; x++) {

                  let optName = $(optionN[x]).val();
                  if (!optionNChk(optName, x)) {
                     return;
                  }
                  let optVal = $(optionV[x]).val();

                  if (!optionVChk(optVal, x)) {
                     return;
                  }

               }

               let arr = [];

               for (let i = 0; i < optionV.length; i++) {
                  let optionLength = $(optionV[i]).val();
                  let optionVal = optionLength.split(',');
                  arr.push(optionVal);
               }
               let box0 = arr[0];
               let box1 = arr[1];
               let box2 = arr[2];
               let idx2 = 0;
               console.log(box0[0]);
               if (optionV.length == 1) {
                  let idx = 0;
                  for (let i = 0; i < box0.length; i++) {
                     let tr = $('<tr/>');

                     td = $('<td/>');
                     input = $('<input />').val(box0[i]);
                     input.addClass("form-control");
                     input.attr('name', 'optionDetail[' + i + '].optionLast');
                     input.attr('id', 'optionLast' + idx);
                     input.attr('readonly', 'true');
                     td.append(input);
                     tr.append(td);

                     td = $('<td/>');
                     let inputN = $('<input />').attr('type', 'number');
                     inputN.addClass("form-control");
                     inputN.attr('name', 'optionDetail[' + i + '].optionPrice');
                     inputN.attr('id', 'optionPrice' + idx);
                     inputN.attr('min',1);
                     inputN.css("width", "100px");
                     inputN.attr('placeholder', 0);
                     
                     td.append(inputN);
                     tr.append(td);

                     td = $('<td/>');
                     inputN = $('<input />').attr('type', 'number');
                     inputN.addClass("form-control");
                     inputN.attr('name', 'optionDetail[' + i + '].optionCount');
                     inputN.attr('id', 'optionCount' + idx);
                     inputN.css("width", "100px");
                     inputN.attr('min',1);
                     inputN.attr('placeholder', 0);
                     td.append(inputN);
                     tr.append(td);

                     td = $('<td/>');
                     inputN = $('<input />').attr('type', 'number');
                     inputN.addClass("form-control");
                     inputN.attr('name', 'optionDetail[' + i + '].minOrder');
                     inputN.attr('id', 'minOrder' + idx);
                     inputN.css("width", "100px");
                     inputN.attr('min',1);
                     inputN.attr('placeholder', 0);
                     td.append(inputN);
                     tr.append(td);

                     td = $('<td/>');
                     inputN = $('<input />').attr('type', 'number');
                     inputN.addClass("form-control");
                     inputN.attr('name', 'optionDetail[' + i + '].maxOrder');
                     inputN.attr('id', 'maxOrder' + idx);
                     inputN.css("width", "100px");
                     inputN.attr('min',1);
                     inputN.attr('placeholder', 0);
                     td.append(inputN);
                     tr.append(td);
                     tbody.append(tr);
                     idx++;
                     idx2++
                  }
               } else if (optionV.length == 2) {
                  let idx = 0;
                  for (let i = 0; i < box0.length; i++) {
                     for (let j = 0; j < box1.length; j++) {
                        let tr = $('<tr/>');

                        td = $('<td/>');
                        input = $('<input />').attr('value', box0[i] + box1[j]);
                        input.addClass("form-control form-control-sm");
                        input.attr('name', 'optionDetail[' + idx + '].optionLast');
                        input.attr('id', 'optionLast' + idx);
                        input.attr('readonly', 'true');
                        td.append(input);
                        tr.append(td);

                        td = $('<td/>');
                        let inputN = $('<input />').attr('type', 'number');
                        inputN.attr('name', 'optionDetail[' + idx + '].optionPrice');
                        inputN.addClass("form-control form-control-sm");
                        inputN.attr('id', 'optionPrice' + idx);
                        inputN.css("width", "100px");
                        inputN.attr('min',1);
                        inputN.attr('placeholder', 0);
                        td.append(inputN);
                        tr.append(td);

                        td = $('<td/>');
                        inputN = $('<input />').attr('type', 'number');
                        inputN.attr('name', 'optionDetail[' + idx + '].optionCount');
                        inputN.addClass("form-control form-control-sm");
                        inputN.attr('id', 'optionCount' + idx);
                        inputN.css("width", "100px");
                        inputN.attr('min',1);
                        inputN.attr('placeholder', 0);
                        td.append(inputN);
                        tr.append(td);

                        td = $('<td/>');
                        inputN = $('<input />').attr('type', 'number');
                        inputN.attr('name', 'optionDetail[' + idx + '].minOrder');
                        inputN.addClass("form-control form-control-sm");
                        inputN.attr('id', 'minOrder' + idx);
                        inputN.css("width", "100px");
                        inputN.attr('min',1);
                        inputN.attr('placeholder', 0);
                        td.append(inputN);
                        tr.append(td);

                        td = $('<td/>');
                        inputN = $('<input />').attr('type', 'number');
                        inputN.attr('name', 'optionDetail[' + idx + '].maxOrder');
                        inputN.addClass("form-control form-control-sm");
                        inputN.attr('id', 'maxOrder' + idx);
                        inputN.css("width", "100px");
                        inputN.attr('min',1);
                        inputN.attr('placeholder', 0);
                        td.append(inputN);
                        tr.append(td);
                        tbody.append(tr);

                        idx++;
                        idx2++
                     }
                  }

               } else if (optionV.length == 3) {
                  let idx = 0;
                  for (let i = 0; i < box0.length; i++) {
                     for (let j = 0; j < box1.length; j++) {
                        for (let x = 0; x < box2.length; x++) {
                           let tr = $('<tr/>');

                           td = $('<td/>');
                           input = $('<input />').attr('value', box0[i] + box1[j] + box2[x]);
                           input.addClass("form-control form-control-sm");
                           input.attr('name', 'optionDetail[' + idx + '].optionLast');
                           input.attr('id', 'optionLast' + idx);
                           input.attr('readonly', 'true');
                           td.append(input);
                           tr.append(td);

                           td = $('<td/>');
                           let inputN = $('<input />').attr('type', 'number');
                           inputN.attr('name', 'optionDetail[' + idx + '].optionPrice');
                           inputN.addClass("form-control form-control-sm");
                           inputN.attr('id', 'optionPrice' + idx);
                           inputN.css("width", "100px");
                           inputN.attr('min',1);
                           inputN.attr('placeholder', 0);
                           td.append(inputN);
                           tr.append(td);

                           td = $('<td/>');
                           inputN = $('<input />').attr('type', 'number');
                           inputN.attr('name', 'optionDetail[' + idx + '].optionCount');
                           inputN.addClass("form-control form-control-sm");
                           inputN.attr('id', 'optionCount' + idx);
                           inputN.css("width", "100px");
                           inputN.attr('min',1);
                           inputN.attr('placeholder', 0);
                           td.append(inputN);
                           tr.append(td);

                           td = $('<td/>');
                           inputN = $('<input />').attr('type', 'number');
                           inputN.attr('name', 'optionDetail[' + idx + '].minOrder');
                           inputN.addClass("form-control form-control-sm");
                           inputN.attr('id', 'minOrder' + idx);
                           inputN.css("width", "100px");
                           inputN.attr('min',1);
                           inputN.attr('placeholder', 0);
                           td.append(inputN);
                           tr.append(td);

                           td = $('<td/>');
                           inputN = $('<input />').attr('type', 'number');
                           inputN.attr('name', 'optionDetail[' + idx + '].MaxOrder');
                           inputN.addClass("form-control form-control-sm");
                           inputN.attr('id', 'maxOrder' + idx);
                           inputN.css("width", "100px");
                           inputN.attr('min',1);
                           inputN.attr('placeholder', 0);
                           td.append(inputN);
                           tr.append(td);
                           tbody.append(tr);
                           idx++;
                           idx2++
                        }
                     }
                  }
               }
               $('#optionNum').val("Y");
               if(idx2 < 5){
            	   let height = idx2 * 150;
            	   $('.tableWrapper').css("height",height+"px");
               }else{
	               $('.tableWrapper').css("height","600px");
            	   
               }
            }

         })

         // 임시저장
         $(".storage").on("click", function (e) {
        	 e.preventDefault();
          
             let select = $('select[name="categoryCode"]');
             if ($(select).val() == null || $(select).val() == "") {
                alert("카테고리를 넣어주세요");
                return;
             }
             let inputfile = $('#imgName');
             let files = inputfile[0].files;
             if (files.length == 0) {
                alert("대표이미지를 등록해주세요");
                inputfile.focus();
                return;
             }
            e.preventDefault();
            let inputTag = $("<input/>");
            inputTag.attr("name", "productExstatus");
            inputTag.prop("type", "hidden");
            $(inputTag).val("C");

            let detailData = JSON.parse(localStorage.getItem("detail"));
            if (detailData != null) {
                let formT = $('#insertForm');
                if (detailData.content != null || detailData.content != '') {
                   let textarea = $('<textarea>' + detailData.content + '</textarea>');
                   textarea.css("display", "none");
                   textarea.attr("name", "productContent");
                   $(formT).prepend(textarea);
                }

                if (detailData.img.length != 0) {
                   for (let i = 0; i < detailData.img.length; i++) {
                      let divTab = $('<div/>');
                      let obj = detailData.img[i];
                      for (var key in obj) {
                         let input = $('<input/>');
                         $(input).val(obj[key]);
                         input.attr("type", "hidden");
                         input.attr("name", "imgsVO[" + i + "]." + key);
                         input.addClass(key);
                         divTab.append(input);
                      }
                      $(divTab).appendTo(formT);
                   }
                }
             }
			
            test22 = "/insertProduct"
            $("#insertForm").append(inputTag);
            $("#insertForm").submit();
         })


         // localstorage에 담고 보내기
         $('.detailPro').on('click', function (e) {
            // localstorage 저장
            localStorage.removeItem('product');
            e.preventDefault();

            let obj = {
               productName: $('input[name="productName"]').val(),
               productCost: $('input[name="productCost"]').val(),
               salePrice: $('input[name="salePrice"]').val(),
               productCount: $('input[name="productCount"]').val(),
               productBrand: $('input[name="productBrand"]').val(),
               optCnt: $('select[name="optCnt"]').val(),
               unitsInStock: $('input[name="unitsInStock"]').val(),
               productOrigin: $('input[name="productOrigin"]').val(),
               productMakeorigin: $('input[name="productMakeorigin"]').val(),
               minOrder: $('input[name="minOrder"]').val(),
               maxOrder: $('input[name="maxOrder"]').val(),
               productLocation: $('input[name="productLocation"]').val(),
               deliveryCost: $('input[name="deliveryCost"]').val() == "" ? 0 : $('input[name="deliveryCost"]')
                  .val(),
               exchangeCost: $('input[name="exchangeCost"]').val() == "" ? 0 : $('input[name="exchangeCost"]')
                  .val(),
               returnCost: $('input[name="returnCost"]').val() == "" ? 0 : $('input[name="returnCost"]').val(),
               deliveryService: $('select[name="deliveryService"]').val(),
               imgInfo: $('#Imginform').val(),
               productImgCon: $('#productImgCon').val(),
               option: [{
                     optionName1: $('input[id="optionName0"]').val(),
                     optionValue1: $('input[id="optionVal0"]').val(),
                  },
                  {
                     optionName1: $('input[id="optionName1"]').val(),
                     optionValue1: $('input[id="optionVal1"]').val(),
                  },
                  {
                     optionName1: $('input[id="optionName2"]').val(),
                     optionValue1: $('input[id="optionVal2"]').val(),
                  },
               ],
               optionDetail: [

               ],
               expire: Date.now() + 7200000,
               catemenu: [

               ],
               optionNum: $('#optionNum').val(),


               
               
            }
            //let optionDetail = [];
            // 옵션 저장
            let leng = $('#optiontab').find('tr').length;
            for (let i = 0; i < leng; i++) {
               let box = {
                  optionLast: $('input[id="optionLast' + i + '"]').val(),
                  optionPrice: $('input[id="optionPrice' + i + '"]').val(),
                  optionCount: $('input[id="optionCount' + i + '"]').val(),
                  minOrder: $('input[id="minOrder' + i + '"]').val(),
                  maxOrder: $('input[id="maxOrder' + i + '"]').val()
               };
               obj.optionDetail.push(box);
            }

            // 카테고리 저장
            let catemenu1 = {};
            $('#categoryCode').find('option').map(function () {
               if ($('#categoryCode option:selected').val() == $(this).val()) {
                  catemenu1["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu1[$(this).text()] = $(this).val();
               }

            });
            obj.catemenu.push(catemenu1);

            let catemenu2 = {};
            $('#categoryCode01').find('option').map(function () {
               if ($('#categoryCode01 option:selected').val() == $(this).val()) {
                  catemenu2["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu2[$(this).text()] = $(this).val();
               }

            });

            obj.catemenu.push(catemenu2);

            let catemenu3 = {};
            $('#categoryCode02').find('option').map(function () {
               if ($('#categoryCode02 option:selected').val() == $(this).val()) {
                  catemenu3["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu3[$(this).text()] = $(this).val();
               }
            });

            obj.catemenu.push(catemenu3);

            let catemenu4 = {};
            $('#categoryCode03').find('option').map(function () {
               if ($('#categoryCode03 option:selected').val() == $(this).val()) {
                  catemenu4["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu4[$(this).text()] = $(this).val();
               }
            });

            obj.catemenu.push(catemenu4);
            // localStorage저장
            // window.localStorage.setItem("product", JSON.stringify(obj));
            //location.href = '/productContent';
            
          var _width = '900';
		    var _height = '900';
		 
		    // 팝업을 가운데 위치시키기 위해 아래와 같이 값 구하기
		      var _left = Math.ceil(( window.screen.width - _width )/2);
		      var _top = Math.ceil(( window.screen.height - _height )/2); 
		            
            let child = window.open('/seller/productContent', 'productcontent', 'width='+ _width +', height='+ _height +', left=' + _left + ', top='+ _top);
         })

         // 등록 이벤트
         $('.submit').on('click', function (e) {
            e.preventDefault();
            let chk = "N";
         
            let select = $('select[name="categoryCode"]');
            if ($(select).val() == null || $(select).val() == "") {
               alert("카테고리를 넣어주세요");
               return;
            }

            if (!idChk($("#productName").val())) {
               return;
            }

            if (!productCostChk($('#productCost').val())) {
               return;
            }

            if (!salePriceChk($('#salePrice').val())) {
               return;
            }

            if ($('#optCnt').val() == 0) {
               if (!productCountChk($('#productCount').val())) {
                  return;
               }
            }

            if ($('#optCnt').val() != 0) {
               if (!optionChk()) {
                  return;
               }

               if (!changeOption()) {
                  return;
               }
               let optionDetailChk = $("#optiontab tr");
               $(optionDetailChk).each(function (idx, item) {
               let n = 0;
               chk = "N";
               let count = 0;
               let min = 0;
               let max = 0;
               let inputBox = $(item).find("input");
               for (let i = 0; i < inputBox.length; i++) {
                  let tbox = inputBox[i];
                  if ($(tbox).attr("id") == "optionPrice" + idx) {
                     if (!optPrice($(tbox).val())) {
                        $(tbox).focus();
                        break;
                     }
                     n++
                  }
                  
                  if ($(tbox).attr("id") == "optionCount" + idx) {
                     if (!optCount($(tbox).val())) {
                        count = $(tbox).val();
                        console.log("count" + count);
                        $(tbox).focus();
                        break;
                     }
                     console.log(count);
                     n++
                  }
                  if ($(tbox).attr("id") == "minOrder" + idx) {
                     min = $(tbox).val();
                     if (!optMin($(tbox).val())) {
                        $(tbox).focus();
                        break;
                     }
                     console.log(min);
                     // if($(tbox).val() <  count){
                     //    $(tbox).focus();
                     //    alert("최소수량이 수량보다 많습니다.");
                     //    break;
                     // }
                     n++
                  }
                  if ($(tbox).attr("id") == "maxOrder" + idx) {
                     max = $(tbox).val();
                     if (!optMax($(tbox).val())) {
                        $(tbox).focus();
                        break;
                     }
                     
                     // if($(tbox).val() >  count){
                     //    $(tbox).focus();
                     //    alert("최대수량이 수량보다 많습니다.");
                     //    break;
                     // }
                     // if($(tbox).val() >  min){
                     //    $(tbox).focus();
                     //    alert("최대수량이 최소수량보다 적습니다.");
                     //    break;
                     // }
                     n++
                  }
               }
               if (n != 4) {
                  return false;
               }
               chk = "Y";
            })

            if (chk == "N") {
               return;
            }
            }
                     
            // 옵션 검사 해야함
            let inputfile = $('#imgName');
            let files = inputfile[0].files;
            if (files.length == 0) {
               alert("대표이미지를 등록해주세요");
               inputfile.focus();
               return;
            }

            if ($("#productImgCon").val() == "") {
               alert("이미지 대체 텍스트를 입력해주세요");
               inputfile.focus();
               return;
            }
            let chk2 = $("#productImgCon").val();
            if (chk2.length > 100) {
               alert("이미지 대체 텍스트 100자 이내입니다.");
               inputfile.focus();
               return;
            }

            if (!imgChk(files[0].name, files[0].size)) {
               inputfile.focus();
               return;
            }

            let detailImg = $(".imgName");
            let detailContent = $(".imgContet");

            // 브랜드 
            if (!brandChk($("#productBrand").val())) {
               return;
            }

            if (!orginchk($("#productOrigin").val())) {
               return;
            }

            if (!makerChk($("#productMakeorigin").val())) {
               return;
            }
            if(!locationChk($("#productLocation").val())){
               return;
            }

            if (!deliveryCostChk($("#deliveryCost").val())) {
               return;
            }

            if (!exchangeCostChk($("#exchangeCost").val())) {
               return;
            }

            if (!returnCost($("#returnCost").val())) {
               return;
            }

            if ($("#deliveryService").val() == null || $("#deliveryService").val() == "") {
               alert("택배사를 선택해주세요");
               $("#deliveryService").focus();
               return;
            }

            let detailData = JSON.parse(localStorage.getItem("detail"));
            if(detailData != null){
               let textarea = $('<textarea>' + detailData.content + '</textarea>');
               textarea.css("display", "none");
               textarea.attr("name", "productContent");
               $("#insertForm").prepend(textarea);
               for(let i = 0; i<detailData.img.length; i++){
                  let divTab = $('<div/>');
                  let obj = detailData.img[i];
                  for(var key in obj){
                     let input = $('<input/>');
                     $(input).val(obj[key]);
                     input.attr("type", "hidden");
                     input.attr("name","imgsVO["+i+"]."+key);
                     divTab.append(input);
                  }
                  $(divTab).appendTo($("#insertForm"));

               }
            }
            if ($("#insertForm").find('textarea[name="productContent"]').length == 0) {
                alert("상세 설명을 입력해주세요");
                return;
             }
             if ($('textarea[name="productContent"]').val() == "") {
                alert("상세 설명을 적어주세요");
                return;
             }

		  for (let x = 0; x < detailImg.length; x++) {
               let chk1 = detailImg[x];
               let chk2 = detailContent[x];

               if ($(chk1).val == "") {
                  alert("상세 설명 이미지를 넣어주세요");
                  return;
               }
               if ($(chk2).val() == "") {
                  alert("상세 설명 이미지 대체텍스트를 넣어주세요");
               }
            }
            test22 = "/insertProduct";

           	$("#insertForm").submit();
         })

         // 상품명 유효성 검사
         function idChk(id) {
            if (id == '') {
               alert("상품명을 입력해주세요");
               $("#productName").focus();
               $("#productName").select();
               return false;
            }
            if (id.length > 50) {
               alert("상품명은 1~50자 이하로 입력해주세요");
               $("#productName").focus();
               $("#productName").select();
               return false;
            }

            return true;
         }

         // 판매가 체크
         function productCostChk(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("판매가를 입력해주세요.");
               $('#productCost').focus();
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               $('#productCost').focus();
               return false;
            }
            if (cost <= 1) {
               alert("최소 금액은 1원 이상이여야합니다.");
               $('#productCost').focus();
               return false;
            }
            if (cost > 99999999) {
               alert("1억 이상은 입력하실수 없습니다.");
               $('#productCost').focus();
               return false;
            }
            return true;
         }

         // 할인가 체크
         function salePriceChk(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("할인가를 입력해주세요.");
               $('#salePrice').focus();
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               $('#salePrice').focus();
               return false;
            }
            if (cost <= 1) {
               alert("최소 금액은 1원 이상이여야합니다.");
               $('#salePrice').focus();
               return false;
            }
            if (cost > 99999999) {
               alert("1억 이상은 입력하실수 없습니다.");
               $('#salePrice').focus();
               return false;
            }
            if (Number(cost) > Number($('#productCost').val())) {
               console.log("cost" + cost);
               console.log($('#productCost').val());
               alert("할인가가 판매가보다 높을수 없습니다.");
               $('#salePrice').focus();
               return false;
            }
            return true;
         }

         // 상품 갯수 체크
         function productCountChk(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("수량를 입력해주세요.");
               $('#productCount').focus();
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               $('#productCount').focus();
               return false;
            }
            if (cost < 1) {
               alert("수량은 0보다 커야합니다.");
               $('#productCount').focus();
               return false;
            }
            if (cost > 99999999) {
               alert("수량은 1억개보다 작아야합니다.");
               $('#productCount').focus();
               return false;
            }
            return true;
         }

         // option chk
         function optionChk() {
            if ($("#optionNum").val() == "N") {
               alert("옵션등록을 해주세요");
               $(".optionsel").focus();
               return false;
            }

            let optionName = $('.optionN');
            let optionVal = $('.optionV');

            for (let x = 0; x < optionName.length; x++) {
               let name = $(optionName[x]).val();
               if (!optionNChk(name, x)) {
                  return false;
               }
               let val = $(optionVal[x]).val();
               if (!optionVChk(val, x)) {
                  return false;
               }
            }

            return true;
         }

         // 옵션 등록 input 유효성 검사
         function optionNChk(name, idx) {
            if (name == "") {
               alert((idx + 1) + "번째 옵션명을 적어주세요");
               $('#optionName' + idx).focus();
               return false;
            }
            if (name.length > 15) {
               alert("옵션명 길이는 15자 입니다.");
               $('#optionName' + idx).focus();
               return false;
            }

            return true;
         }

         // 옵션 등록 input 유효성 검사
         function optionVChk(val, idx) {
            if (val == "") {
               alert((idx + 1) + "번째 옵션값을 적어주세요");
               $('#optionValue' + idx).focus();
               return false;
            }
            if (val.length > 100) {
               alert("100자 이내로 써주세요");
               $('#optionValue' + idx).focus();
               return false;
            }

            let value = val.split(",");
            let length = value.length;
            for (let x = 0; x < length; x++) {
               if (value[x] == '') {
                  alert("옵션 값 양식이 틀립니다.");
                  $('#optionValue' + idx).focus();
                  return false;
               }

            }
            return true;
         }


         function optPrice(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("옵션가를 입력해주세요.");
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               return false;
            }
            if (cost < 0) {
               alert("최소 금액은 0원 이상이여야합니다.");
               return false;
            }
            if (cost > 99999999) {
               alert("1억 이상은 입력하실수 없습니다.");
               return false;
            }

            return true;
         }

         function optCount(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("수량를 입력해주세요.");
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               return false;
            }
            if (cost <= 0) {
               alert("수량은 0보다 커야합니다.");
               return false;
            }
            if (cost > 99999999) {
               alert("수량은 1억개보다 작아야합니다.");
               return false;
            }
            return true;
         }

         function optMin(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("옵션최소수량를 입력해주세요.");
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               return false;
            }
            if (cost <= 0) {
               alert("수량은 0보다 커야합니다.");
               return false;
            }
            if (cost > 99999999) {
               alert("수량은 1억개보다 작아야합니다.");
               return false;
            }
            return true;
         }

         function optMax(cost) {
            let check = /^[0-9]+$/;
            // if (cost == '') {
            //    alert("옵션최대수량를 입력해주세요.");
            //    return false;
            // }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               return false;
            }
            if (cost < 0) {
               alert("수량은 0보다 커야합니다.");
               return false;
            }
            if (cost > 99999999) {
               alert("수량은 1억개보다 작아야합니다.");
               return false;
            }
            return true;
         }




         // 옵션 값 변경 체크
         function changeOption() {
            let changechk1 = $('.optionN');
            let changechk2 = $('.optionV');


            if (optbox.length != changechk1.length) {
               //$('#optionNum').val('N');
               alert("옵션 값을 체크 해주세요");
               $('#optionsel').focus();
               return false;
            }

            if (optbox1.length != changechk2.length) {
               //$('#optionNum').val('N');
               alert("옵션 값을 체크 해주세요");
               $('#optionsel').focus();
               return false;
            }
            if (changechk1.length == 1) {
               if ($(optbox).val() != $(changechk1).val()) {
                  alert("옵션 값이 다릅니다.");
                  changechk1.focus();
                  return false;
               }
               if ($(optbox1).val() != $(changechk2).val()) {
                  alert("옵션 값이 다릅니다.");
                  changechk2.focus();
                  return false;
               }
            } else {
               for (let s = 0; s < changechk1.length; s++) {
                  let b1 = optbox[s];
                  let b2 = changechk1[s];
                  if ($(b1).val() != $(b2).val()) {
                     alert("옵션 값이 다릅니다.");
                     return false;
                  }
               }

               for (let s = 0; s < changechk2.length; s++) {
                  let b1 = optbox1[s];
                  let b2 = changechk2[s];
                  if ($(b1).val() != $(b2).val()) {
                     alert("옵션 값이 다릅니다.");
                     return false;
                  }
               }

            }


            return true;

         }

         // 이미지 체크
         function imgChk(name, size) {
            var regex = new RegExp("(.*?)\.(jpg|jpeg|png|gif|jfif)$");
            var maxSize = 5242880; // 5MB

            if (size >= maxSize) {
               alert("파일 사이즈가 5MB가 넘습니다.");
               return false;
            }

            if (!regex.test(name)) {
               alert("해당 종류의 파일은 업로드할 수 없습니다.");
               return false;
            }

            return true;
         }


         // 브랜드 유효성 검사
         function brandChk(val) {
            if (val == "") {
               alert("브랜드를 입력해주세요");
               $("#productBrand").focus();
               return false;
            }
            if (val.length > 30) {
               alert("브랜드 30자 이내로 써주세요");
               $("#productBrand").focus();
               return false;
            }

            return true;
         }

         // 원산지
         function orginchk(val) {
            var pattern_spc = /[~!@#$%^&*()_+|<>?:{}]/;
            if (val == "") {
               alert("원산지를 입력해주세요");
               $("#productOrigin").focus();
               return false;
            }
            if (pattern_spc.test(val)) {
               alert("원산지에 특수문자는 입력하실수 없습니다.");
               $("#productOrigin").focus();
               return false;
            }
            if (val.length > 15) {
               alert("원산지 15이내로 입력해주세요");
               $("#productOrigin").focus();
               return false;
            }
            return true;
         }

         // 제조국 유효성 검사
         function makerChk(val) {
            var pattern_spc = /[~!@#$%^&*()_+|<>?:{}]/;
            if (val == "") {
               alert("제조국를 입력해주세요");
               $("#productMakeorigin").focus();
               return false;
            }
            if (pattern_spc.test(val)) {
               alert("제조국에 특수문자는 입력하실수 없습니다.");
               $("#productMakeorigin").focus();
               return false;
            }
            if (val.length > 15) {
               alert("제조국 15이내로 입력해주세요");
               $("#productMakeorigin").focus();
               return false;
            }
            return true;
         }

         // 출고지 유효성 검사
         function locationChk(val) {
            var pattern_spc = /[~!@#$%^&*()_+|<>?:{}]/;
            if (val == "") {
               alert("출고지를 입력해주세요");
               $("#productMakeorigin").focus();
               return false;
            }
            if (pattern_spc.test(val)) {
               alert("제조국에 특수문자는 입력하실수 없습니다.");
               $("#productMakeorigin").focus();
               return false;
            }
            if (val.length > 70) {
               alert("출고지 70이내로 입력해주세요");
               $("#productMakeorigin").focus();
               return false;
            }
            return true;
         }

         function deliveryCostChk(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("기본배송비를 입력해주세요.");
               $('#deliveryCost').focus();
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               $('#deliveryCost').focus();
               return false;
            }
            if (cost < 0) {
               alert("최소 금액은 0원 이상이여야합니다.");
               $('#deliveryCost').focus();
               return false;
            }
            if (cost > 99999999) {
               alert("1억 이상은 입력하실수 없습니다.");
               $('#deliveryCost').focus();
               return false;
            }
            return true;
         }

         function exchangeCostChk(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("교환배송비를 입력해주세요.");
               $('#exchangeCost').focus();
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               $('#exchangeCost').focus();
               return false;
            }
            if (cost < 0) {
               alert("최소 금액은 0원 이상이여야합니다.");
               $('#exchangeCost').focus();
               return false;
            }
            if (cost > 99999999) {
               alert("1억 이상은 입력하실수 없습니다.");
               $('#exchangeCost').focus();
               return false;
            }
            return true;
         }

         function returnCost(cost) {
            let check = /^[0-9]+$/;
            if (cost == '') {
               alert("반품배송비를 입력해주세요.");
               $('#returnCost').focus();
               return false;
            }
            if (!check.test(cost)) {
               alert("숫자만 입력가능합니다.");
               $('#returnCost').focus();
               return false;
            }
            if (cost < 0) {
               alert("최소 금액은 0원 이상이여야합니다.");
               $('#returnCost').focus();
               return false;
            }
            if (cost > 99999999) {
               alert("1억 이상은 입력하실수 없습니다.");
               $('#returnCost').focus();
               return false;
            }
            return true;
         }


         // modal 정보 넣기
         $(".modalBtn").on("click", function () {
            localStorage.removeItem('product');

            let obj = {
               productName: $('input[name="productName"]').val(),
               productCost: $('input[name="productCost"]').val(),
               salePrice: $('input[name="salePrice"]').val(),
               productCount: $('input[name="productCount"]').val(),
               files: $('input[name="files"]').val(),
               productBrand: $('input[name="productBrand"]').val(),
               optCnt: $('select[name="optCnt"]').val(),
               unitsInStock: $('input[name="unitsInStock"]').val(),
               productOrigin: $('input[name="productOrigin"]').val(),
               productMakeorigin: $('input[name="productMakeorigin"]').val(),
               minOrder: $('input[name="minOrder"]').val(),
               maxOrder: $('input[name="maxOrder"]').val(),
               productLocation: $('input[name="productLocation"]').val(),
               deliveryCost: $('input[name="deliveryCost"]').val() == "" ? 0 : $('input[name="deliveryCost"]')
                  .val(),
               exchangeCost: $('input[name="exchangeCost"]').val() == "" ? 0 : $('input[name="exchangeCost"]')
                  .val(),
               returnCost: $('input[name="returnCost"]').val() == "" ? 0 : $('input[name="returnCost"]').val(),
               delService: $('select[name="deliveryService"] option:selected').text(),
               productImgCon: $('#productImgCon').val(),
               imgInfo: $('#Imginform').val(),
               option: [{
                     optionName1: $('input[id="optionName0"]').val(),
                     optionValue1: $('input[id="optionVal0"]').val(),
                  },
                  {
                     optionName1: $('input[id="optionName1"]').val(),
                     optionValue1: $('input[id="optionVal1"]').val(),
                  },
                  {
                     optionName1: $('input[id="optionName2"]').val(),
                     optionValue1: $('input[id="optionVal2"]').val(),
                  },
               ],
               optionDetail: [

               ],
               expire: Date.now() + 7200000,
               catemenu: [

               ],
               optionNum: $('#optionNum').val(),


            }


            //let optionDetail = [];
            // 옵션 저장
            let leng = $('#optiontab').find('tr').length;
            for (let i = 0; i < leng; i++) {
               let box = {
                  optionLast: $('input[id="optionLast' + i + '"]').val(),
                  optionPrice: $('input[id="optionPrice' + i + '"]').val(),
                  optionCount: $('input[id="optionCount' + i + '"]').val(),
                  minOrder: $('input[id="minOrder' + i + '"]').val(),
                  maxOrder: $('input[id="maxOrder' + i + '"]').val()
               };
               obj.optionDetail.push(box);
            }

            // 카테고리 저장
            let catemenu1 = {};
            $('#categoryCode').find('option').map(function () {
               if ($('#categoryCode option:selected').val() == $(this).val()) {
                  catemenu1["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu1[$(this).text()] = $(this).val();
               }

            });
            obj.catemenu.push(catemenu1);

            let catemenu2 = {};
            $('#categoryCode01').find('option').map(function () {
               if ($('#categoryCode01 option:selected').val() == $(this).val()) {
                  catemenu2["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu2[$(this).text()] = $(this).val();
               }

            });

            obj.catemenu.push(catemenu2);

            let catemenu3 = {};
            $('#categoryCode02').find('option').map(function () {
               if ($('#categoryCode02 option:selected').val() == $(this).val()) {
                  catemenu3["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu3[$(this).text()] = $(this).val();
               }
            });

            obj.catemenu.push(catemenu3);

            let catemenu4 = {};
            $('#categoryCode03').find('option').map(function () {
               if ($('#categoryCode03 option:selected').val() == $(this).val()) {
                  catemenu4["0" + $(this).text()] = $(this).val();
               } else {
                  catemenu4[$(this).text()] = $(this).val();
               }
            });

            obj.catemenu.push(catemenu4);
            // localStorage저장
            window.localStorage.setItem("product", JSON.stringify(obj));


            $(".Mdetail").children().remove();
            $(".selectbox").children().remove();
            $(".Mimg").children().remove();

            let userData = JSON.parse(localStorage.getItem("product"));
            let detailData = JSON.parse(localStorage.getItem("detail"));

            let div = $(".Mimg");
            let img = $("<img/>");
            $(img).attr('src', userData.imgInfo);
            $(img).css("width", "100%");
            $(img).css("height", "100%");
            let divTag = $("<div />");
            divTag.css("width", "100%");
            divTag.css("height", "100%");

            divTag.append(img);
            // let inputTag = $('<input/>');
            // divTag.append(inputTag);

            div.append(divTag);

            let num = userData.catemenu.length;

            let catelog;
            if (Object.keys(userData.catemenu[0]).length != 0) {
               catelog = userData.catemenu[0];
            };
            if (Object.keys(userData.catemenu[1]).length != 0) {
               catelog = userData.catemenu[1];
            };
            if (Object.keys(userData.catemenu[2]).length != 0) {
               catelog = userData.catemenu[2];
            };
            if (Object.keys(userData.catemenu[3]).length != 0) {
               catelog = userData.catemenu[3];
            };

            for (var key in catelog) {
               if (key.charAt(0) == 0) {
                  keyword = key.substr(1);
                  $(".Mcate").text(keyword);
               }
            }

            $(".MproName").text(userData.productName);
            let Cost = replaceComma(userData.productCost);
            console.log(Cost);
            $(".Mprice").text(Cost);
            let  Sale = replaceComma(userData.salePrice);
            console.log(Sale);
            $(".MSale").text(Sale);
            $(".Mdelivery").text(userData.delService);
            
            let delCost = replaceComma(userData.deliveryCost);
            $(".Mdelprice").text(delCost);
            $(".Mmaker").text(userData.productOrigin);

            let sel = $(".selectbox");

            if (Object.keys(userData.option[0]).length != 0) {

               let select = $("<select/>");
               select.addClass("form-select mb-2");
               let optbox = $("<option>" + userData.option[0].optionName1 + "</option>");
               optbox.prop("disabled", "true");
               select.append(optbox);
               //for(let i = 0; i<userData.option[0].length; i++){
               let value = userData.option[0].optionValue1.split(",");
               for (let x = 0; x < value.length; x++) {
                  let option = $("<option>" + value[x] + "</option>");
                  select.append(option);
               }
               // }
               sel.append(select);
            };

            if (Object.keys(userData.option[1]).length != 0) {
               let select = $("<select/>");
               select.addClass("form-select mb-2");
               let optbox = $("<option>" + userData.option[1].optionName1 + "</option>");
               optbox.prop("disabled", "true");
               select.append(optbox);
               //for(let i = 0; i<userData.option[0].length; i++){
               let value = userData.option[1].optionValue1.split(",");
               for (let x = 0; x < value.length; x++) {
                  let option = $("<option>" + value[x] + "</option>");
                  select.append(option);
               }
               // }
               sel.append(select);

            };
            if (Object.keys(userData.option[2]).length != 0) {
               let select = $("<select/>");
               select.addClass("form-select mb-2");
               let optbox = $("<option>" + userData.option[2].optionName1 + "</option>");
               optbox.prop("disabled", "true");
               select.append(optbox);
               //for(let i = 0; i<userData.option[0].length; i++){
               let value = userData.option[2].optionValue1.split(",");
               for (let x = 0; x < value.length; x++) {
                  let option = $("<option>" + value[x] + "</option>");
                  select.append(option);
               }
               // }
               sel.append(select);
            };

          




            let memberId = [[${session.loginMember}]];
            if (memberId != null) {
               $(".sellerName").text(memberId.memberId);
               $(".sellerNum").text(memberId.businessNumber);
            }

            var today = new Date();

            var year = today.getFullYear();
            var month = ('0' + (today.getMonth() + 1)).slice(-2);
            var day = ('0' + today.getDate()).slice(-2);

            var dateString = year + '-' + month + '-' + day;

            $(".today").text(dateString);
            if (detailData.content != "") {
               $(".Mdetail").append(detailData.content);
            }
         })
         
         // 숫자 ,로 변경
         function replaceComma(num){
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','); 
         }  

         $(document).on('keydown',numberBox ,function(e){
           if($(':focus').prop('type') == 'number'){   
              if(e.keyCode == 110 || e.keyCode == 109 || e.keyCode == 189 || e.keyCode == 190 || e.keyCode == 107){
                 return false;
               }
               if(e.shiftKey && e.keyCode ==187){
                  return false;
               }
            }
         })





         // 정지여부체크
         $.ajax({
        	 url:"",
        	 type:"",
        	 success : function(result){
        		if(result == 1){
        			
        		}else{
        			alert("정지된 계정입니다.");
        		}
        	 },
        	 error : function(err){
        		 
        	 }
        	 
         })
      </script>


		<style>
			.modal img{
				width:100%;
			}
			
			.tableWrapper {

			    overflow: auto;
			}
		
			#userListTable {
			    border-collapse: collapse;
			}
			
			#userListTable th {
			    position: sticky;
			    top: 0px;
			    background-color:cornflowerblue;
			}
		</style>
      </div>
   </div>

</html>
