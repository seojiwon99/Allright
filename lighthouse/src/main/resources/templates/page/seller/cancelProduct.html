<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/insertModifyPro}">

<!-- Content -->

<div layout:fragment="sellerContent">
<style>
._1Vof48UxmD_oVRNwPvxck {
	background-color: rgb(248, 249, 250);
	padding : 20px;
}
.pb-12{
	background-color: rgb(248, 249, 250);
	padding : 20px;
	margin-top : 20px;
}


._KqV0-1BSnB {
	float:left;
}


._4LshyCrDpi, ._3y2h2mGnkI, ._MN8nIh0X4y {
    margin-left: 10px; /* 왼쪽 여백 추가 (선택적으로 조절) */
    margin-top: 50px;
    
}
._MN8nIh0X4y{
margin-left:400px;
}


.btn-default2 .badge {
	color: #8991a3;
	background-color: #fff
}

.btn-primary2 {
	color: #666;
	background-color: #fff;
	border-color: #dbdde2
}

.btn-primary2.focus, .btn-primary2:focus {
	color: #666;
	background-color: black;
	border: 2px solid white;
}

.btn-primary2.active, .btn-primary2:active, .btn-primary2:hover, .open>.dropdown-toggle.btn-primary2
	{
	color: #666;
	background-color: black;
	border: 2px solid gray;
}
.btn-primary2.active.focus, .btn-primary2.active:focus, .btn-primary2.active:hover,
	.btn-primary2:active.focus, .btn-primary2:active:focus, .btn-primary2:active:hover,
	.open>.dropdown-toggle.btn-primary2.focus, .open>.dropdown-toggle.btn-primary2:focus,
	.open>.dropdown-toggle.btn-primary2:hover {
	color: #666;
	background-color: #d4d4d4;
	border-color: #949aa9
}

.btn-primary2.active, .btn-primary2:active, .open>.dropdown-toggle.btn-primary2
	{
	background-image: none
}

.btn-primary2.disabled.focus, .btn-primary2.disabled:focus,
	.btn-primary2.disabled:hover, .btn-primary2[disabled].focus,
	.btn-primary2[disabled]:focus, .btn-primary2[disabled]:hover, fieldset[disabled] .btn-primary2.focus,
	fieldset[disabled] .btn-primary2:focus, fieldset[disabled] .btn-primary2:hover
	{
	background-color: #fff;
	border-color: #dbdde2
}

#orderSearch {
    border-radius: 10px; /* 테두리를 둥글게 만듭니다. */
    color: #ffffff; /* 텍스트 색상을 흰색으로 지정합니다. */
    padding: 10px 20px; /* 내용 주변의 여백을 조절합니다. */
    border: none; /* 테두리를 없앱니다. */
    margin-left:200px;
}


#orderSearch:hover {
    background-color: gray; 
}

.btn{
    border-radius: 10px; /* 테두리를 둥글게 만듭니다. */
}
.btn-primary2{
 padding : 10px;
}
.searchDate{
	margin-top:10px;
}
input, select, button{
	border-radius: 5px;
}
.btnGo{
	padding-left:10px;
	padding-right:10px;
	background-color:black;
	color : white;
}
::-webkit-scrollbar {
  width: 12px; /* 가로 스크롤바 너비 조절 */
}

::-webkit-scrollbar-track {
  background: #f1f1f1; /* 스크롤바 트랙 배경색 */
}

::-webkit-scrollbar-thumb {
  background: #888; /* 스크롤바 썸 배경색 */
  border-radius: 6px; /* 스크롤바 썸 둥글게 만들기 */
}
</style>
	
		

	
				<!---->
				
											

				<div class="_1Vof48UxmD_oVRNwPvxck">
							
								<div class="_KqV0-1BSnB">
									<button type="button" id="todayBtn" class="btn btn-primary2">
										<span id="today">오늘</span>
									</button>
									<button type="button" id="weekBtn" class="btn btn-primary2">
										<span id="week">1주일</span>
									</button>
									<button type="button" id="oneMonthBtn" class="btn btn-primary2">
										<span id="onemonth">1개월</span>
									</button>
									<button type="button" id="threeMonthBtn"
										class="btn btn-primary2">
										<span id="thmonth">3개월</span>
									</button>

									<div id="dateDisplay"></div>
									<div class="searchDate">
										<span>조회기간</span> <input type="DATE" id="from" name="from"
											autocomplete="off"> <label for="to">~</label> <input
											type="DATE" id="to" name="to" autocomplete="off">
									</div>
								</div>
							


							<div class="detailSea">
									<label class="_MN8nIh0X4y">상세조건</label> <select
										class="_4LshyCrDpi" title="리스트 보기">
										<option selected value="">전체</option>
										<option value="member_name">구매자명</option>
										<option value="member_tel">구매자연락처</option>
										<option value="member_id">구매자ID</option>
										<option value="product_code">상품코드</option>
										<option value="delivery_number">송장번호</option>
									</select> 
									<input type="text" class="_3y2h2mGnkI" value="" maxlength="50">
							</div>
									
									
							<button type="button" id="orderSearch" class="btn btn-dark mb-2">검색</button>
							</div>
							
					
					<section class="pb-12">
					<button type="button" id="cancelOk" class="btnGo">취소승인</button>
					<button type="button" id="cancelReject" class="btnGo">취소거부</button>
						<div style="width:1450px; height: 500px; overflow: auto; border: 1px; position: relative;">
						
						<table border="1" class="table" id="getProductList" style="background-color:white;  white-space: nowrap;">
							<thead style="position: sticky; top: 0; background-color: white;">
								<tr>
									<th><input type="checkbox" id="allCheck"></th>
									<th>주문번호</th>
									<th>상품명</th>
									<th>주문상태</th>
									<th>취소이유</th>
									<th>결제일</th>
									<th>취소요청일</th>
									<th>취소상태</th>
									<th>구매자</th>
								</tr>
							</thead>
							<tbody id="cancelList">
								<tr th:each="cancel : ${cancelInfo}">
									<td><input type="checkbox"></td>
									<td th:text="${cancel.orderDetailCode}"></td>
									<td th:text="${cancel.productName}"></td>
									<td th:text="${cancel.orderStatus}"></td>
									<td th:text="${cancel.cancelReason}"></td>
									<td th:text="${#dates.format(cancel.chargeDate, 'yyyy-MM-dd')}"></td>
									<td th:text="${#dates.format(cancel.cancelRegdate, 'yyyy-MM-dd')}"></td>
									<td th:if="${cancel.cancelStatus} == 'Y'">취소승인</td>
									<td th:unless="${cancel.cancelStatus} == 'Y'">취소대기</td>
									<td th:text="${cancel.memberName}"></td>
									<td th:text="${cancel.memberId}" class="visually-hidden"></td>
									<td th:text="${cancel.orderCode}" class="visually-hidden"></td>
									<td th:text="${cancel.cancelCode}" class="visually-hidden"></td>
									

								</tr>
								<!-- 반복문 종료 -->
							</tbody>
						</table>
						</div>
					</section>


	<script>
$(document).ready(function () {		
		
		document.getElementById('allCheck')
		.addEventListener('click', allCheckEvent);

		function allCheckEvent(e) {
		    let allCheckTag = document.getElementById('allCheck');
		    let checkTags = document.querySelectorAll('[type="checkbox"]');
		    checkTags.forEach(el => {
		        el.checked = allCheckTag.checked;
		    })
		}
		
		$('#orderSearch').on('click',function(){
			let key = $('._4LshyCrDpi').val();
			let value = $('._3y2h2mGnkI').val();
			let fromDate = $('#from').val();
			let toDate = $('#to').val()
			
			console.log(key,value,fromDate,toDate);

			$.ajax({
				url : 'cancelOption',
				type : 'get',
				data : {
					"searchValue" : value, 
			 		"searchKey" : key,
			 		fromDate,
			 		toDate
				}
			})
			 		
			
			.done(cancelInfo=>{
				console.log(cancelInfo);
				 $('#cancelList').replaceWith(cancelInfo); 
				 

			})
			.fail(reject=>{
				console.log(reject);
			})
			
		})
		
		
	 const currentDate = new Date();
		const koreanTime = new Date(currentDate).toLocaleString('en-US', { timeZone: 'Asia/Seoul' });
		const formattedDate = koreanTime.split('T')[0];
	  $('#to').val(formattedDate);
 
  
     // 버튼 클릭 이벤트 처리
	 $('#todayBtn').click(function() {
		displayDate('today');
	  });
	  $('#weekBtn').click(function() {
		displayDate('week');
	  });
	  $('#oneMonthBtn').click(function() {
		displayDate('oneMonth');
	  });
	  $('#threeMonthBtn').click(function() {
		displayDate('threeMonth');
	  });
  
	  // 날짜 표시 함수
function displayDate(range) {
	const currentDate = new Date();
	let startDate, endDate;
  
	switch (range) {
	  case 'today':
		startDate = new Date(currentDate);
		endDate = new Date(currentDate);
		break;
	  case 'week':
		startDate = new Date(currentDate);
		endDate = new Date(currentDate);
		startDate.setDate(endDate.getDate() - 7);
		break;
	  case 'oneMonth':
		startDate = new Date(currentDate);
		endDate = new Date(currentDate);
		startDate.setMonth(endDate.getMonth() - 1);
		break;
	  case 'threeMonth':
		startDate = new Date(currentDate);
		endDate = new Date(currentDate);
		startDate.setMonth(endDate.getMonth() - 3);
		break;
	  default:
		startDate = null;
		endDate = null;
	}
  
	// endDate 값을 input 요소에 설정
	if (startDate) {
	endDate.setDate(endDate.getDate() + 1); // 일자를 +1 하기
	const formattedEndDate = endDate.toISOString().split('T')[0];
	console.log(formattedEndDate); 

	//   formattedYear = formattedEndDate.

	  
	  // input 요소 선택 후 value 설정
	  $('#to').val(formattedEndDate);
	} else {
	  // endDate가 null이면 input 요소 값을 비움
	  $('#to').val('');
	}
  
	// startDate 값을 input 요소에 설정
	if (endDate) {
	  // startDate를 yyyy-mm-dd 형식의 문자열로 변환
	  const formattedStartDate = startDate.toISOString().split('T')[0];
	  
	  // input 요소 선택 후 value 설정
	  $('#from').val(formattedStartDate);
	} else {
	  // startDate가 null이면 input 요소 값을 비움
	  $('#from').val('');
	}
  }
		
$('#cancelOk').on('click',function(){
    let checkTags = $('input[type=checkbox]:checked').not(allCheck);
    refundListVO=[];
    checkTags.each((idx, tag)=>{
       let orderDetailCode = $(tag).parent().next().text();
       let memberId = $(tag).closest('tr').find('td:eq(9)').text();
       let orderCode = $(tag).closest('tr').find('td:eq(10)').text();
       let refundTypecode = $(tag).closest('tr').find('td:eq(11)').text();
       let refundType = "C";
       let cancelReason = $(tag).closest('tr').find('td:eq(4)').text();
       
       console.log(memberId);
       
       let OrderChkVO ={
    		   orderDetailCode : orderDetailCode ,
    		   orderCode : orderCode,
    		   refundTypecode : refundTypecode,
    		   refundType :refundType  ,
    		   cancelReason : cancelReason,
    		   memberId : memberId
       }
       refundListVO.push(OrderChkVO);
    });
    
    console.log(refundListVO);
     
      let $form = $('<form>', {
          method: 'POST',
          action: 'orders/cancel'
      });

      let $input = $('<input>', {
          type: 'hidden',
          name: 'refundList',
          value: JSON.stringify(refundListVO)
      });

      $form.append($input);

      $form.appendTo('body').submit(); 
     
 });
 
	  
	  $('#cancelReject').on('click', function(){
		  let checkTags = $('input[type=checkbox]:checked').not(allCheck);
		  cancelChk = [];
		  checkTags.each((idx, tag)=>{
			  let cancelCode = $(tag).closest('tr').find('td:eq(11)').text();
			  console.log(cancelCode);
			let obj = {
					cancelCode
			}
			cancelChk.push(obj);
		  })
		
		  $.ajax({
			  url:'cancelReject',
			  type: 'post',
			  contentType : 'application/json',
			  data : JSON.stringify(cancelChk)
		  })
		  .done(data=>{
			  refreshList();
		  })
		  .fail(reject =>{
			  console.log(reject);
		  })
	  });
	  
	  function refreshList(){
         location.reload();
      } 
	  
	  
})
	</script>
</div>

</html>