<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default_layout}">

<!-- Content -->
<div layout:fragment="content">
	<!-- BREADCRUMB -->
	<nav class="py-5">
		<div class="container">
			<div class="row">
				<div class="col-12">

					<!-- Breadcrumb -->
					<ol class="breadcrumb mb-0 fs-xs text-gray-400">
						<li class="breadcrumb-item"><a class="text-gray-400"
							href="index.html">Home</a></li>
						<li class="breadcrumb-item active">My Page</li>
					</ol>

				</div>
			</div>
		</div>
	</nav>

	<!-- CONTENT -->
	<section class="pt-7 pb-12">
		<div class="container">
			<div class="row">
			<div class="col-12 col-md-3">

            <!-- Nav -->
            <nav class="mb-10 mb-md-0">
              <div class="list-group list-group-sm list-group-strong list-group-flush-x">
                <a class="list-group-item list-group-item-action dropend-toggle active" th:href="@{/page/buyer/orderList}">
                  주문 목록
                </a>
				<ul class="list-styled mb-0">
				<li class="nav-item">

                  <!-- Toggle -->
                  <a class="list-group-item list-group-item-action dropend-toggle active" data-bs-toggle="collapse" href="#Collapse" aria-expanded="true">
                   취소/반품/교환내역
                  </a>
                  <!-- Collapse -->
                  <div class="collapse" id="Collapse" data-simplebar-collapse="#seasonGroup">
                    <div class="form-group form-group-overflow mb-6" id="seasonGroup">
                      <div class="form-check mb-3">
                        <a class="form-check-label" for="seasonOne" href="cancelList">
                          취소
                        </a>
                      </div>
                      <div class="form-check mb-3">
                        <a class="form-check-label" for="seasonTwo" href="returnList">
                          반품
                        </a>
                      </div>
                      <div class="form-check">
                        <a class="form-check-label" for="seasonThree" href="exchangeList">
                          교환
                        </a>
                      </div>
                    </div>
                  </div>
                 </li>
                <li class="nav-item">
                <a class="list-group-item list-group-item-action dropend-toggle " th:href="@{/page/buyer/myCoupon}">
                  나의 쿠폰함
                </a>
                </li>
                <li class="nav-item">
                <a class="list-group-item list-group-item-action dropend-toggle " th:href="@{/page/buyer/myInquiry}">
                  문의내역
                </a>
                </li>
                 <li class="nav-item">
                <a class="list-group-item list-group-item-action dropend-toggle " th:href="@{/page/buyer/wishList}">
                  찜 목록
                </a>
                </li>
                 <li class="nav-item">
                <a class="list-group-item list-group-item-action dropend-toggle " th:href="@{/page/buyer/personalInfo}">
                  개인정보 확인/수정
                </a>
                </li>
                </ul>
              </div>
            </nav>

          </div>
				<div class="col-12 col-md-9 col-lg-8 offset-lg-1">
					
					<!-- Form -->
					<form>
						
						<div class="row">
							<div class="col-12 col-md-6">

								<!-- Email -->
								<div class="form-group">
									<label class="form-label" for="buyerName"> 
										이름
									</label> 
									<input class="form-control form-control-sm"
										id="buyerName" type="text" placeholder="*"
										th:value="${personalInfo.memberName}" readonly>
								</div>

							</div>
							
							<div class="col-12">

								<!-- Email -->
								<div class="form-group">
									<label class="form-label" for="buyerEmail"> Email 주소  </label> 
									<input class="form-control form-control-sm"
										id="buyerEmail" type="email" placeholder="Email 주소"
										th:value="${personalInfo.memberEmail}" required>
								</div>

							</div>
							<div class="col-12 col-md-6">

								<!-- Password -->
								<div class="form-group">
									<label class="form-label" for="buyerPassword"> 
										새 비밀번호
									</label> 
									<input class="form-control form-control-sm"
										id="buyerPassword" type="password"  placeholder="새 비밀번호 입력">

								</div>

							</div>
							<div class="col-12 col-md-6">

								<!-- Password -->
								<div class="form-group">
									<label class="form-label" for="buyerPasswordCheck"> 
										새 비밀번호 확인
									</label> 
									<input class="form-control form-control-sm"
										id="buyerPasswordCheck" type="password"  placeholder="새 비밀번호 확인">
								</div>

							</div>
							<div class="col-12 col-md-6">

								<!-- Addr -->
								<div class="form-group">
									<label class="form-label" for="buyerAddr">
										주소  </label> <input
										class="form-control form-control-sm" id="buyerAddr"
										type="text" placeholder="*"  th:value="${personalInfo.memberAddr}" required>
								</div>

							</div>
							<div class="col-12 col-md-6">

								<!-- Addr -->
								<div class="form-group">
									<label class="form-label" for="buyerDetailsAddr"> 상세주소 </label> <input class="form-control form-control-sm"
										id="buyerDetailsAddr" type="text"
										placeholder="*" th:value="${personalInfo.memberDetailsAddr}" required>
								</div>

							</div>
							
							<div class="col-12 col-md-6">

								<!-- tel -->
								<div class="form-group">
									<label class="form-label" for="buyerTel"> 전화번호 </label> <input class="form-control form-control-sm"
										id="buyerTel" type="text"
										placeholder="*" th:value="${personalInfo.memberTel}" required>
								</div>

							</div>							
							<div class="col-12 col-lg-6">

								<!-- Birthday -->
								<div class="form-group">

									<!-- Label -->
									<label class="form-label">생년월일</label>

									<!-- Inputs -->
									<div class="row gx-5">
										<div class="col-auto">

											<!-- Date -->
											<label class="visually-hidden" for="buyerBirth">
												Date </label> 
												<input class="form-control form-control-sm" id="buyerBirth" type="text" placeholder="*" 
												 th:value="${personalInfo.memberBirth}" required readonly>

										</div>
									</div>

								</div>
							</div>

							</div>
							<div class="col-12">

								<!-- Button -->
								<button class="btn btn-dark" type="button" id="updateBtn">Save Changes</button>

							</div>
					
					</form>

				</div>
			</div>
		</div>
	</section>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function(){
		$('#updateBtn').on('click', function(){
			let pwData = $('#memberPw').val();
			if( pwData != null){
			} else {
				alert("새 비밀번호를 설정해주세요.")
				$('#buyerPassword').focus();
				return;
			}
			let infoData = {
				'memberPw' : $('#buyerPassword').val(),
				'memberPasswordCheck' : $('#buyerPasswordCheck').val(),
				'memberAddr' : $('#buyerAddr').val(),
				'memberEmail' : $('#buyerEmail').val(),
				'memberDetailsAddr' : $('#buyerDetailsAddr').val(),
				'memberTel' : $('#buyerTel').val(),
				'memberBirth' : $('#buyerBirth').val()
			}
			
			$.ajax({
				url: '/buyer/personalInfoEdit',
				type: 'POST',
				contentType : 'application/json',
				data : JSON.stringify(infoData),
				success : function(response){

						alert("수정 완료");

				},
				error: function(err){
					console.error('정보 수정 중 오류.');
					console.log(err);
				}
			})
		});
		});
		
		// 비밀번호 확인에서 일치 여부 확인
		/*
		$('#buyerPasswordCheck').on('focusout', function(e){
			let password = $('#buyerPassword').val();
			let passwordCheck = $('#buyerPasswordCheck').val();
			
			if(passwordCheck != password){
				alert("비밀번호가 일치하지 않습니다.");
				return;
			}
		});
		*/
		
		// 비밀번호 확인에서 pw 유효성 검사
		$('#buyerPasswordCheck').on('focusout', chkPW);
		function chkPW(){
				let password = $('#buyerPassword').val();
				let pwCheck = $('#buyerPasswordCheck').val();
				
				if(pwCheck != password){
					alert("비밀번호가 일치하지 않습니다.");
					return;
				}
				//let pw = $("#buyerPassword").val();
				//let id = $("#id").val();
			    let checkNumber = pwCheck.search(/[0-9]/g);
			    let checkEnglish = pwCheck.search(/[a-z]/ig);
			 
			    if(!/^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/.test(pwCheck)){            
			        alert('숫자+영문자+특수문자 조합으로 8자리 이상 사용해야 합니다.');
			        return false;
			    }else if(checkNumber <0 || checkEnglish <0){
			        alert("숫자와 영문자를 혼용하여야 합니다.");
			        return false;
			    }else if(/(\w)\1\1\1/.test(pwCheck)){
			        alert('같은 문자를 4번 이상 사용하실 수 없습니다.');
			        return false;
			    } else {

					console.log("통과");
					
					}
		}  
	</script>
</div>
</html>