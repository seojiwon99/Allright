<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.ar.lighthouse.admin.mapper.AdminMapper">
  

  	<insert id="insertNotice" parameterType="NoticeAdminVO">
	  	 <selectKey resultType="int" keyProperty="noticeCode" order="BEFORE">
	  		SELECT NVL(MAX(notice_code),1)+1 FROM ar_notice
	  	</selectKey>
	  	
	  	INSERT INTO ar_notice (
	  						notice_code
	  						, notice_title
	  						, notice_content
	  						<if test="upEnddate != null">
	  						, up_enddate
	  						</if>
	  						, notice_writer
	  						, notice_type
	  						) 
	  					values(
	  						#{noticeCode}
	  						, #{noticeTitle}
	  						, #{noticeContent}
	  						<if test="upEnddate != null">
	  						, #{upEnddate}
	  						</if>
	  						, 'Admin'
	  						, #{noticeType}
	  						)
  	</insert>
  	
  	<insert id="insertFaq" parameterType="FaqVO">
	  	 <selectKey resultType="int" keyProperty="faqCode" order="BEFORE">
	  		SELECT NVL(MAX(faq_code),1)+1 FROM ar_faq
	  	</selectKey>
	  	
	  	INSERT INTO ar_faq (
	  						faq_code
	  						, question_title
	  						, question_answer
	  						, faq_type
	  						) 
	  					values(
	  						#{faqCode}
	  						, #{questionTitle}
	  						, #{questionAnswer}
	  						, #{faqType}
	  						)
  	</insert>
  	
  	<select id="selectDeclareList" resultType="DeclareVO">
		SELECT rt.declare_code, declare_code_name(rt.declare_reason) as declare_reason, rt.declare_content, rt.member_id, rt.declare_member, rt.declare_regdate
		FROM       (
		                SELECT   rownum r,  de.declare_code, de.declare_reason, de.declare_content, de.member_id, de.declare_member, de.declare_regdate
		                FROM   (SELECT
		                        *
		                        FROM ar_declare
		                        where declare_status = 'N'
								<if test="declareContent != null and !(declareContent.equals(''))">
								AND declare_content LIKE '%' || #{declareContent} || '%'
								</if>
								<if test="declareReason != null and !(declareReason.equals(''))">	
								AND declare_reason = #{declareReason}
								</if>
		                        order by declare_code desc) de
		                 <![CDATA[
		                where rownum <= #{pageNum} * #{amount} )rt
		                 ]]>
		WHERE rt.r  > ( #{pageNum} - 1) * #{amount}
  	</select>	
  	<select id="selectTotalDeclareCount" resultType="int">
  	select count(*)
	from ar_declare
	where declare_code > 0 AND declare_status = 'N'
	<if test="declareContent != null and !(declareContent.equals('')) ">
	AND declare_content LIKE '%' || #{declareContent} || '%'
	</if>
	<if test="declareReason != null and !(declareReason.equals(''))">	
	AND declare_reason = #{declareReason}
	</if>
  	</select>
  	
  	<select id="selectDeclareDetail" resultType="declareVO">
  	select 	d.declare_code
  			, declare_code_name(d.declare_reason) as declare_reason
  			, d.declare_regdate
  			, r.review_content
  			, d.declare_content
  			, d.member_id
  			, d.declare_member
  			, r.product_code
  			, (select count(*) from ar_declare where member_id = d.member_id) as declare_count
	from ar_declare d JOIN ar_review r ON d.review_code = r.review_code
	where d.declare_code = #{declareCode}
  	</select>
  	
  	<!-- ClearDeclare -->
  	
  	<select id="selectClearDeclareList" resultType="DeclareVO">
		SELECT rt.declare_code, find_suspend_status_name(rt.suspend_status) as suspend_status
		, declare_code_name(rt.declare_reason) as declare_reason
		, rt.declare_content
		, rt.member_id
		, rt.declare_member
		, rt.declare_regdate
		FROM       (
		                SELECT   rownum r, de.suspend_status, de.declare_code, de.declare_reason, de.declare_content, de.member_id, de.declare_member, de.declare_regdate
		                FROM   (SELECT
		                        *
		                        FROM ar_declare
		                        where declare_status = 'Y'
								<if test="declareContent != null and !(declareContent.equals(''))">
								AND declare_content LIKE '%' || #{declareContent} || '%'
								</if>
								<if test="declareReason != null and !(declareReason.equals(''))">	
								AND declare_reason = #{declareReason}
								</if>
		                        order by declare_code desc) de
		                 <![CDATA[
		                where rownum <= #{pageNum} * #{amount} )rt
		                 ]]>
		WHERE rt.r  > ( #{pageNum} - 1) * #{amount}
  	</select>	
  	<select id="selectTotalClearDeclareCount" resultType="int">
  	select count(*)
	from ar_declare
	where declare_code > 0 AND declare_status = 'Y'
	<if test="declareContent != null and !(declareContent.equals('')) ">
	AND declare_content LIKE '%' || #{declareContent} || '%'
	</if>
	<if test="declareReason != null and !(declareReason.equals(''))">	
	AND declare_reason = #{declareReason}
	</if>
  	</select>
  	
  	
  	<!--  Inquiry -->
  	<select id="selectInquiryList">
 		SELECT rt.*
		FROM       (
		                SELECT   rownum r, aci.*
		                FROM   (SELECT *
		                        FROM AR_CUSTOM_INQUIRY
		                        where CUSTOM_INQUIRY_ANSWER_STATUS = 'N'
		                        <if test="customInquiryTitle != null and !(customInquiryTitle.equals('')) ">
								AND custom_inquiry_title LIKE '%' || #{customInquiryTitle} || '%'
								</if>
		                        order by CUSTOM_INQUIRY_REGDATE DESC, CUSTOM_INQUIRY_CODE desc) aci
		     			    <![CDATA[                   
		                where rownum <= #{pageNum} * #{amount} ) rt
		                ]]>
		WHERE rt.r  > ( #{pageNum} - 1 ) * #{amount}
  	
  	</select>
  	
  	
  	<select id="selectTotalClearInquiryCount">
		  	select count(*)
			from ar_custom_inquiry
			where 1=1
			<if test="customInquiryAnswerStatus == 'Y'">
			AND customInquiryAnswerStatus = 'Y'
			</if>
			<if test="customInquiryAnswerStatus == 'N'">
			AND customInquiryAnswerStatus = 'N'
			</if>
			<if test="customInquiryTitle != null and !(customInquiryTitle.equals('')) ">
			AND custom_inquiry_title LIKE '%' || #{customInquiryTitle} || '%'
			</if>
  	</select>
  	
  	<select id="selectClearInquiryList">
  	 		SELECT rt.*
			FROM       (
			                SELECT   rownum r, aci.*
			                FROM   (SELECT *
			                        FROM AR_CUSTOM_INQUIRY
			                        where CUSTOM_INQUIRY_ANSWER_STATUS = 'Y'
                        			<if test="customInquiryTitle != null and !(customInquiryTitle.equals('')) ">
									AND custom_inquiry_title LIKE '%' || #{customInquiryTitle} || '%'
									</if>
			                        order by CUSTOM_INQUIRY_REGDATE DESC, CUSTOM_INQUIRY_CODE desc) aci
			     			    <![CDATA[                   
			                where rownum <= #{pageNum} * #{amount} ) rt
			                ]]>
			WHERE rt.r  > ( #{pageNum} - 1 ) * #{amount}
  	</select>
  	
  	<select id="selectMemberList" resultType="MemberDetailVO">
  		SELECT rt.*, d_count(rt.member_id) as declare_count, NVL(recent_susp_name(rt.member_id),'사용 가능') as susp_status
		FROM       (
		                SELECT   rownum r, am.*
		                FROM   (SELECT *
		                        FROM AR_MEMBER 
		                        where 1=1
		                        <if test="memberAuthor == 1 or memberAuthor == 3">
		                        AND MEMBER_AUTHOR IN (1,3)
		                        </if>
		                        <if test="memberAuthor == 2">
		                        AND MEMBER_AUTHOR = 2
		                        </if>
		                        <if test="memberId != null and !(memberId.equals(''))">
		                        AND MEMBER_ID LIKE '%' || #{memberId} || '%'
		                        </if>
		                        <if test="memberName != null and !(memberName.equals(''))">
		                        AND MEMBER_NAME LIKE '%' || #{memberName} || '%'
		                        </if>
		                        <if test="memberTel != null and !(memberTel.equals(''))">
		                        AND MEMBER_TEL LIKE '%' || #{memberTel} || '%'
		                        </if>
		                        <if test="businessNumber != null and !(businessNumber.equals(''))">
		                        AND BUSINESS_NUMBER LIKE '%' || #{businessNumber} || '%'
		                        </if>
		                        order by MEMBER_REGDATE DESC) am
		                        <![CDATA[   
		                where rownum <= #{pageNum} * #{amount} )rt
		                   ]]>
		WHERE rt.r  > (#{pageNum} - 1 ) * #{amount}
  	</select>
  	
  	<select id="selectTotalUserCount" resultType="int">
	  	select count(*)
		from ar_member
		where 1 =  1
		<if test="memberAuthor == 1 or memberAuthor == 3">
		AND member_author IN (1,3)
		</if>
		<if test="memberAuthor == 2">
	  	AND member_author = 2
	  	</if>
    	<if test="memberId != null and !(memberId.equals(''))">
        AND MEMBER_ID LIKE '%' || #{memberId} || '%'
        </if>
        <if test="memberName != null and !(memberName.equals(''))">
        AND MEMBER_NAME LIKE '%' || #{memberName} || '%'
        </if>
        <if test="memberTel != null and !(memberTel.equals(''))">
        AND MEMBER_TEL LIKE '%' || #{memberTel} || '%'
        </if>
        <if test="businessNumber != null and !(businessNumber.equals(''))">
        AND BUSINESS_NUMBER LIKE '%' || #{businessNumber} || '%'
        </if>
  	
  	</select>
  	

  	<select id="selectProductList">
		  	SELECT  rt.*
			FROM       (
		                SELECT   rownum r, pr.*
		                FROM   (select pp.product_code, pp.product_name, pp.member_id,  mm.member_tel, mm.business_number
                                from ar_products pp JOIN ar_member mm  ON pp.member_id = mm.member_id
								where 1=1
								<if test="memberId != null and !(memberId.equals(''))">
						        AND mm.MEMBER_ID LIKE '%' || #{memberId} || '%'
						        </if>
						        <if test="memberTel != null and !(memberTel.equals(''))">
						        AND mm.MEMBER_TEL LIKE '%' || #{memberTel} || '%'
						        </if>
						        <if test="businessNumber != null and !(businessNumber.equals(''))">
						        AND mm.BUSINESS_NUMBER LIKE '%' || #{businessNumber} || '%'
						        </if>
						        <if test="productCode != null and !(productCode.equals(''))">
						        AND pp.PRODUCT_CODE LIKE '%' || #{productCode} || '%'
		                        </if>
		                        order by product_regdate desc) pr
		                        <![CDATA[
		                WHERE rownum <= #{pageNum} * #{amount}) rt
		                ]]>
			WHERE rt.r > ( #{pageNum} - 1 ) * #{amount} 
  	</select>
  	
  	<select id="selectTotalProductCount">
  			SELECT count(*)
  			FROM ar_products pp JOIN ar_member mm ON pp.member_id = mm.member_id
  			WHERE 1=1
	    	<if test="memberId != null and !(memberId.equals(''))">
	        AND mm.MEMBER_ID LIKE '%' || #{memberId} || '%'
	        </if>
	        <if test="memberTel != null and !(memberTel.equals(''))">
	        AND mm.MEMBER_TEL LIKE '%' || #{memberTel} || '%'
	        </if>
	        <if test="businessNumber != null and !(businessNumber.equals(''))">
	        AND mm.BUSINESS_NUMBER LIKE '%' || #{businessNumber} || '%'
	        </if>
	        <if test="productCode != null and !(productCode.equals(''))">
	        AND pp.PRODUCT_CODE LIKE '%' || #{productCode} || '%'
	        </if>
  	</select>
  	
  	<select id="selectAdminNoticeList">
  	 		SELECT rt.*
			FROM       (
			                SELECT   rownum r, an.*
			                FROM   (SELECT *
			                        FROM ar_notice
			                        where 1=1
			                        <if test="noticeAdminVO.noticeTitle != null and !(noticeAdminVO.noticeTitle.equals('')) ">
									AND notice_title LIKE '%' || #{noticeAdminVO.noticeTitle} || '%'
									</if>
			                        order by notice_type desc, notice_code desc) an
			     			    <![CDATA[                   
			                where rownum <= #{cri.pageNum} * #{cri.amount} ) rt
			                ]]>
			WHERE rt.r  > ( #{cri.pageNum} - 1 ) * #{cri.amount}	
  	</select>
  	
  	
  	<select id="selectTotalNoticeCount" resultType ="int">
  		select count(*)
  		FROM ar_notice 
  		WHERE 1=1
  		<if test="noticeTitle != null and !(noticeTitle.equals('')) ">
  		AND notice_title LIKE '%' || #{noticeTitle} || '%'
  		</if>
  	</select>
  	
  	
  	
  	
  </mapper>
  