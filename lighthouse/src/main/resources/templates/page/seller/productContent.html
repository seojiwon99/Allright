<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/sellerHtml}">
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<!-- Content -->
<div layout:fragment="sellerContent">
   <style>
      .ck.ck-editor {
         width: 80%;
         max-width: 800px;
         margin: 0 auto;
      }
      
      .ck-editor__editable {
         height: 80vh;
      }
      
      form {
         text-align: center;
      }
   </style>
   <!-- ckeditor cdn -->
    <script src="https://ckeditor.com/apps/ckfinder/3.5.0/ckfinder.js"></script>
   
   <div class="row gx-0" style="margin-bottom:20px;">
	<form action="/insertImg" method="post" id="textForm">
		<div id="editor"></div>
		<input type="button" class="btn btn-secondary mt-3 mx-2" value="작성취소" />
		<input type="submit" id="submit" class="" value="작성완료" />
	</form>



   <!-- CKEditor -->
      <script src="https://ckeditor.com/apps/ckfinder/3.5.0/ckfinder.js"></script>
      <script>      
      ClassicEditor
      .create(document.querySelector('#editor'),{
         ckfinder:{
            uploadUrl : '/image/upload'
         }
         //console.log(ckfinder);
      })
      .then(editor => {
         window.editor = editor;
         console.log('Editor was initialized');
      })
      .catch(error => {
         console.error(error);
      });
      </script>
    
      
   </div>
   <script text="text/javascript">
    

  $('.addImgBtn').on('click',function(e){
      e.preventDefault();
      let form = $(this).closest('form');
 	 $('.inform').remove();
      let formTag = $('.ck .image');

      let srcArr = [];
      $(formTag).each(function(idx,item){
         let src = $(item).children('img').attr('src');
   
         let text = src.split('_');
         
         let text01 = src.split('/');
         console.log(text01);
         let data = {
         	imgName : text[1],
         	uploadPath : text01[1] + '\\' + text01[2] + '\\' + text01[3],
         	uploadFile : text01[4],
         	imgContent : $(item).children('figcaption').text()
         };
         srcArr.push(data);
      })
      
      let idx = 0;
      for(let i =0; i < srcArr.length; i++){
         let divTag = $('<div/>').addClass('inform');
         let obj = srcArr[i];
         for(let item in obj){
            console.log("key" + item );
            console.log("value" + obj[item]);
            let str = `
            	<input type="text" name="imgsVO[${idx}].${item}" value="${obj[item]}">
            `;
            
            divTag.append(str);
         }
         idx++;
         form.append(divTag);
      }
      
      form.attr('method', 'post');
      form.attr('action', '/insertImg');
      form.submit();
      console.log(srcArr);
  })
  
/*   $('#textForm').sumbit(function(e){
	  e.preventDefaul();
  }) */
  
  $('#submit').on('click',function(e){
	  	$('textarea[name="productContent"]').remove();
	  	/* e.preventDefault(); */
		let form = $(this).closest('form');
		console.log(form);
		// form.attr('method', 'post');
		// form.attr('action', '/insertImg');
		
		let data = editor.getData();
		let textarea = $('<textarea />');
		textarea.css("display", "none");
		textarea.attr('name','productContent');
		
		$(textarea).text(data);
		
		$(textarea).append(data);
		$(form).append(textarea);
		
		console.log($(textarea).val());

		
		
		// form.submit();
  })
   </script>
</div>
</html>