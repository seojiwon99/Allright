<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:th="http://www.thymeleaf.org"
   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   layout:decorate="~{layouts/insertModifyPro}">
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<!-- Content -->




<div layout:fragment="sellerContent">


  
      <div class="col-12 col-lg">

         
         <h3>상품조회/수정</h3>


         <div style="float:left;">
            <button type="button" id="chkDelBtn">전시중/전시중지</button>
         </div>
         <div>
            <select id="optionList" style="float:right; margin-right:500px">
               <option></option>
               <option value="상품등록일순">상품등록일순</option>
               <option value="상품명순">상품명순</option>
               <option value="누적판매건수">누적판매건수</option>
               <option value="전시중">전시중</option>
               <option value="전시중지">전시중지</option>
            </select>
         </div>


         <!-- CARDS -->
         <section class="pb-12">
			<div style="width:100%; height: 500px; overflow:auto; border:1px; ">
            <table border="1" class="table" id="getProductList">
               <thead>
                  <tr>
                     <th><input type="checkbox" id="allCheck"></th>
                     <th>수정</th>
                     <th>상품코드</th>
                     <th>상품명</th>
                     <th>재고수량</th>
                     <th>판매가</th>
                     <th>할인가</th>
                     <th>배송비</th>
                     <th>상품등록일</th>
                     <th>전시상태</th>
                  </tr>
               </thead>
               <tbody id="sortList">
                  <tr th:each="product : ${productList}">
                     <td><input type="checkbox"></td>
                     <td> 
                     <a th:href="@{'/updateProduct?productCode=' + ${product.productCode}}">
                             <button id="modifyForm" class="modifyForm" type="button">수정</button>
                            </a>
                            </td>
                     <td th:text="${product.productCode}"></td>
                     <td th:text="${product.productName}"></td>
                     <td th:text="${product.optionDetail[0].optionCount}"/>
                     <td th:text="${product.productCost}"></td>
                     <td th:text="${product.salePrice}"></td>
                     <td th:text="${product.deliveryCost}"></td>
                     <td
                        th:text="${#dates.format(product.productRegdate,'yyyy-MM-dd')}">상품등록일</td>
                     <td th:text="${product.productExstatus}">전시상
                     
                     태</td>
                  </tr>
                  <!-- 반복문 종료 -->
               </tbody>
            </table>
            </div>
         </section>



      </div>


   <script th:inline="javascript">
   
   
   
   $(document).ready(function(){
      let data = [[${msg}]];
      if(data != null){
         alert(data);
         localStorage.removeItem('detail');
         localStorage.removeItem('product');
      }


   
   
   $('#optionList').on('change',function(){
      
      let val = $(this).val();
      console.log(val);
      $.ajax({
         url : 'getOptionProduct',
         type :'get',
         data : {
            "optionVal" : val
         }
         })
      .done(productList => {
         console.log(productList);         
           //let newTbody = $('<tr><td><input type="checkbox"></td></tr>');
           // newTbody.append(data);

         $("#sortList").replaceWith(productList);
      })
      .fail(reject =>{
         
      })
   })

   
   
   
   document.getElementById('allCheck')
   .addEventListener('click', allCheckEvent);

   function allCheckEvent(e) {
       let allCheckTag = document.getElementById('allCheck');
       let checkTags = document.querySelectorAll('[type="checkbox"]');
       checkTags.forEach(el => {
           el.checked = allCheckTag.checked;
       })
   }
   

   $('#chkDelBtn').on('click',function(){
      let proList = [];
      let checkTags = $('input[type="checkbox"]:checked').not('#allcheck');
      
      console.log(checkTags);
      
      checkTags.each((idx, tag) => {
         let productCode = $(tag).parent().next().next().text();
         let obj = {'productCode' : productCode};
         proList.push(obj);
      })
   
      
      
      $.ajax({
         /* let val = $(this).val();
         console.log(val); */
         url : 'updateExStatus',
         type: 'post',
         contentType : 'application/json',
         data : JSON.stringify(proList)
      })
      .done(data => {
         
         refreshList();
         
      })
      .fail(reject => console.log(reject));
   
   });
   
     $('#chkY').on('click',function(){
      let proList = [];
      let checkTags = $('input[type="checkbox"]:checked').not('#allcheck');
      
      console.log(checkTags);
      
      checkTags.each((idx, tag) => {
         let productCode = $(tag).parent().next().next().text();
         let obj = {'productCode' : productCode};
         proList.push(obj);
      })
   
      
      
      $.ajax({
         
         url : 'updateExStatus',
         type: 'post',
         contentType : 'application/json',
         data : JSON.stringify(proList)
      })
      .done(data => {
         
         refreshList();
         
      })
      .fail(reject => console.log(reject));
   
   });  

   
   function refreshList(){
      location.reload();
   }
   
   $('.modifyForm').on('click', function () {
       let productCode = $(this).closest('tr').find('td:eq(2)').text();
       alert('hk');
       console.log(productCode);

       $.ajax({
           url: 'updateProduct',
           type: 'get',
           data: {
               productCode
           }
       })
       .done(data => {
           console.log(data);
           localStorage.setItem('productCode', productCode);
           location.href = '/updateProduct?productCode=' + productCode ;
           

        console.log('productCode 값:', productCode);
       })
       .fail(reject => {
           console.log(reject);
       });
   });

   
})
</script>

</div>


</html>